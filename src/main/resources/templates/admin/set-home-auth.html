<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<!-- Tell the browser to be responsive to screen width -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
	<title>首页功能菜单</title>
	<link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/css/common.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/select2/select2.css}"/>
	<link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.css}" />
	<link rel="stylesheet" th:href="@{/static/dist/css/skins/_all-skins.min.css}" />
	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-validator/css/bootstrapValidator.min.css}"/>
	<style type="text/css">
		html,body {overflow-x:hidden;height:100%;min-height:100%;}
		body {
			padding-top:50px;
		}
		.navbar{padding: 0 10px;}
		.bar_left {
		    float: left;
		    line-height: 49px;
		}
		.bar_right {
		    float: right;
		    line-height: 49px;
		}
		.page_title {
		    width: 50%;
		    position: absolute;
		    left: 25%;
		    font-weight: 400;
		    text-align: center;
		    color: #232528;
		    font-size: 18px;
		    overflow: hidden;
		    white-space: nowrap;
		    text-overflow: ellipsis;
		    margin-top:none;
		}
		.col-sm-10 span{    
			word-break: break-all;
		    word-wrap: break-word;
		    white-space: normal;
		    display: block;
		    float:left;
		    height: 34px;
		    padding: 6px 12px 6px 0px;
		    font-size: 14px;
		    line-height: 1.42857143;
		    color: #777;
	    }
	    .wapp-icon{border: 0 !important;cursor: pointer;}
	    #wapp_icon{cursor: pointer;}
	    .logo_img {
		    padding-top: 5px;
		    height: 70px;
		    width: 70px;
		    display: inline-block;
		    position: relative;
		    -webkit-border-radius: 10%;
		    -moz-border-radius: 10%;
		    border-radius: 10%;
		    -webkit-background-clip: padding-box;
		    -moz-background-clip: padding-box;
		    background-clip: padding-box;
		}
		.border_alpha {
			text-align: center;
		    border: 1px solid #eee;
		    border-color: rgba(0,0,0,.1);
		    -moz-background-clip: padding;
		    -webkit-background-clip: padding;
		    background-clip: padding-box;
		}
		.img-thumbnail{
			width:60px;
		}
		.col-sm-10-span {
		    word-break: break-all;
		    word-wrap: break-word;
		    white-space: normal;
		    display: block;
		    float: left;
		    height: 34px;
		    padding: 6px 12px 6px 0px;
		    font-size: 14px;
		    line-height: 1.42857143;
		    color: #777;
		}
	</style>
</head>
<body>
	<nav id="nav_main" class="navbar navbar-fixed-top navbar-default">
		<div class="bar_left"><button class="btn btn-default" type="button" onclick="fnGoBack()"><em class="glyphicon glyphicon-arrow-left"></em></button></div>
	  	<h2 class="page_title" style="margin-top:15px;" th:text="${parentAuth.name}+'-首页应用功能'"></h2>
	</nav>
	<div id="container_main" class="container">
		<input type="hidden" id="parentId" th:value="${parentAuth.id}"/>
		<div class="row" style="margin-top:15px;" id="auth_list">
			<div class="col-md-3 col-sm-6 col-xs-12">
				<div class="thumbnail" style="border: 1px dotted #ddd;">
					<a type="button" class="btn btn-block" onclick="goEditAuth()"><em class="fa fa-plus"></em><span>新增功能菜单</span></a>
				</div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript" th:src="@{/static/plugins/jQuery/jquery-2.2.3.min.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script type="text/javascript" th:src="@{/static/plugins/jQueryUI/jquery-ui.min.js}"></script>
<script type="text/javascript" th:src="@{/static/bootstrap/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/select2/select2.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-validator/js/bootstrapValidator.min.js}"></script>
<script type="text/javascript" th:src="@{/static/js/common.js}"></script>
<script type="text/javascript" th:src="@{/static/wapp/wapp-icon-config.js}"></script>
<script type="text/javascript" th:inline="javascript">
/*<![CDATA[*/
	var CTX = [[@{/}]];
	var STATIC = [[@{/static/}]];
	$(function(){
		$("#roleType_selmenu").select2({
		    tags: true,
		    placeholder: "选择角色类型",
		    allowClear: true
		});
		//初始化数据
		initData();
		
	    $("#auth_list").sortable({
		    handle: ".handle",
		    opacity: 0.6, //拖动时，透明度为0.6
		    forcePlaceholderSize: true,
		    zIndex: 999999,
		    update : function(event, ui){
		    	var items = $(this).sortable("toArray");
		    	$.ajax({
		    		url: CTX+'authority/save-auth-sort',
		    		type:'POST',
		    		dataType:'text',
		    		traditional:true,
		    		data:{authIds:items},
		    		success:function(text){
		    			if(text=='error'){
		    				alert('保存出错');
		    			}
		    		},
		    		error:function(){
		    			alert('请求超时或系统出错');
		    		}
		    	});
    		}
	  	});
	});
	
	function initData(){
		loading("正在加载...");
		$.ajax({
			url:CTX+'authority/query-home-auth',
			type:'GET',
			dataType:'json',
			data:{parentId:$("#parentId").val()},
			success:function(json){
				loaded();
				$('#auth_list .list-item').remove();
				if(json){
					var htmlStr = '';
					$.each(json,function(i,auth){
						htmlStr += 
							'<div class="col-md-3 col-sm-6 col-xs-12 list-item" id="'+auth.id+'">'+
							'	<div class="thumbnail">'+
							'		<a href="javascript:goEditAuth(\''+auth.id+'\')" class="btn btn-block btn-social wapp-btn">'+
				            '   	  	<img class="img-polaroid wapp-icon handle" src="'+STATIC+'/wapp/icons/'+auth.icon+'"/>'+
				            '			<span>'+auth.name+'</span>'+
				           	'	  	</a>'+
							'	</div>'+
							'</div>';
					});
					$('#auth_list').prepend(htmlStr);
				}
			},
			error:function(){
				loaded();
				alert('请求超时或系统错误');
			}
		});	
	}
	//新增编辑
	function goEditAuth(id){
		id = id==undefined?'':id;
		window.location.href = CTX+'authority/set-home-auth-input.html?parentId='+$("#parentId").val()+'&authId='+id;
	}
	//返回
	function fnGoBack(){
		window.location.href = CTX+"authority/input.html?authId="+$("#parentId").val();
	}
/*]]>*/		
</script>	
</html>