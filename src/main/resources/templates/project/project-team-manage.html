<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--
* @Copyright(c): 厦门路桥信息股份有限公司  版权所有
* @author :XMRBI
* @Description:项目班组管理 
* @createDate:2018-3-19
-->
<head>
	<meta charset="UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
	<title>项目班组管理</title>
	<link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/jvectormap/jquery-jvectormap-1.2.2.css}"/>
  	<!-- iCheck for checkboxes and radio inputs -->
  	<link rel="stylesheet" th:href="@{/static/plugins/iCheck/all.css}"/>
  	<!-- daterange picker -->
  	<link rel="stylesheet" th:href="@{/static/plugins/daterangepicker/daterangepicker.css}"/>
  	<!-- bootstrap datepicker -->
  	<link rel="stylesheet" th:href="@{/static/plugins/datepicker/datepicker3.css}"/>
  	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.css}"/>
	<!-- Bootstrap 3.3.7 -->
	<link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.css}"/>
	<!-- Theme style -->
	<link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/dist/css/skins/_all-skins.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/css/common.css}"/>
	<style type="text/css">
	.form-horizontal .control-label{text-align: left;}
	.modal-header{
	 text-align:center;
	} 
	
	.modal-footer{
	 text-align:center;
	 padding: 5px;
	} 
	.my-select{
	    	position: absolute;
		    left: 15px;
		    right: 15px;
		    top: 35px;
	       max-height: 200px;
    		overflow: auto;
		    border: 1px solid #ddd;
		    z-index: 100;
		    background: #fff;
		}
		
	#viewForm input{
	background-color:transparent;
	border: 0px;
	outline: none;
	margin-top: 5px;
	}
	</style>
</head>
<body>
    <div class="content">
    	<div class="box box-default collapsed-box box-solid" style="margin-bottom:5px;">
            <div class="box-header with-border">
              	<h3 class="box-title">查询条件</h3>
              	<div class="box-tools pull-right">
                	<button type="button" class="btn btn-box-tool" data-widget="collapse" onclick="fnResetTable()"><i class="fa fa-plus"></i></button>
             	</div>
              	<!-- /.box-tools -->
            </div>
            <div class="box-body">
              <form id="formSearch" class="form-horizontal">
            	<input type="hidden" id="projectInfoId" name="projectInfoId" th:value="${projectInfoId}"/>
                  <div class="row">
	            		<div class="col-md-4">
	            			<div class="form-group" style="margin-top:1px">
                        <label class="control-label col-sm-5">单位名称:</label>
                        <div class="col-sm-7" style="padding:0;"> 
                       <input type="text" class="form-control" id="queryCompanyName" name="companyName" />  
                       		 </div>
                       	 </div>
                       </div>
                        <div class="col-md-4">
	            			<label class="control-label col-sm-5">单位类型:</label>
	                        <div class="col-sm-7" style="padding:0;"> 
                        	<select id="useunitTypeId" name="useunitType.id" class="form-control">
                        		<option th:selected="selected" value="">选择单位类型</option>
		                		<option  th:each="useunitType : ${useunitTypes}" th:value="${useunitType.typeName}" th:text="${useunitType.typeName}" ></option>
		                 	</select>
                         </div>
                         </div>
                        <div class="col-md-4">
                            <button type="button" onclick="queryInfo()" style="margin-left:50px" id="btn_query" class="btn btn-primary">查询</button>
                        </div>
                     </div>
                </form>
            </div>
        </div>

        <div id="toolbar" class="btn-group" >
            <button id="btn_add" type="button" class="btn btn-primary">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
            </button>
            <button id="btn_delete" type="button" class="btn btn-danger">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
            </button>
        </div>
        <table id="dataList"></table>
    </div>
    
    <!-- 模态框开始 -->
    <div class="modal fade" id="addModal" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" aria-hidden="true">
		<div class="modal-dialog" style="width:900px;">
			<div class="modal-content">
				<div class="modal-header">
				 	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h5 class="modal-title">项目班组管理</h5>
				</div>
	<div class="modal-body" style="overflow: hidden; padding: 10px;">
	  <form class="form-horizontal" id="myform" name="myform">
        
        <div class="box box-default box-solid" style="margin-bottom:5px;">
            <div class="box-header with-border">
              	<h3 class="box-title">单位基本信息</h3>
              	<div class="box-tools pull-right">
                	<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                	</button>
             	</div>
            </div>
            <div class="box-body" style="display: block;">
            	<div class="row">
            		<div class="col-md-6">
            			<div class="form-group">
            			<input type="hidden" id="id" name="id" value=""/>
            			 <input type="hidden" id="projectInfoId" name="projectInfo.id" th:value="${projectInfoId}"/>
            			 <input type="hidden" name="annexIds" value=""/>  
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;单位名称:</label>
		                  	<div class="col-sm-9">
			                  	<div class="input-group">
		                    	<input type="text" class="form-control" name="companyName" id="myCompanyName"/>
		                    	  <div class="input-group-btn">
					                <button  type="button" class="btn btn-primary" onclick="btnSelect()">选择</button>
					                </div> 
					            </div>
					            <div class="my-select">
					           <table style="width: 100%;">
					            <tbody>
							   	 <tr th:each="partCompany: ${partCompanys}">
							      <td>
							      <button  type="button" class="btn btn-primary" onclick="Selected(this)" th:attr="data-name=${partCompany.name},data-socialCreditCode=${partCompany.socialCreditCode},data-type=${partCompany.useunitType.id}" style="width:100%">
							      <span th:text="${partCompany.name}"></span>
							      </button>
							      </td>
							  	 </tr>
								 </tbody>
								</table>
					            </div>
		                  	</div>
		                </div>
            		</div>
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-5 control-label"><i style="color:red;">*</i>&nbsp;统一社会信用代码:</label>
		                  	<div class="col-sm-7">
	                    		<input type="text" class="form-control" name="socialCreditCode" id="social_creditcode"/>
		                  	</div>
		                </div>
            		</div>
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;单位类型:</label>
		                  	<div class="col-sm-9">
		                 <select name="useunitType.id" class="form-control" id="useunitType">
		                <option  th:each="useunitType : ${useunitTypes}" th:value="${useunitType.id}" th:text="${useunitType.typeName}" ></option>
		                 </select>
		                  	</div>
		                </div>
            		</div>
            	</div>
            </div>
        </div> 
        	       
        <div class="box box-default box-solid" style="margin-bottom:5px;">
            <div class="box-header with-border">
              	<h3 class="box-title">项目班组信息</h3>
              	<div class="box-tools pull-right">
                	<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                	</button>
             	</div>
              	<!-- /.box-tools -->
            </div>
            <!-- /.box-header -->
            <div class="box-body" style="display: block;">
              	<div class="row">
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;班组名称:</label>
		                  	<div class="col-sm-9">
	                    		<input type="text" class="form-control" name="teamName"/>
		                  	</div>
		                </div>
            		</div>
         		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;入场时间:</label>
		                  	<div class="col-sm-9">
	                    		<div class="input-group date">
				                  	<input type="text" class="form-control mydatepicker" readonly="readonly" name="admissionTime" />
				                  	<div class="input-group-addon">
				                    	<i class="fa fa-calendar"></i>
				                  	</div>
				                </div>
				          	</div>
		                </div>
            		</div> 
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;组长名称:</label>
		                  	<div class="col-sm-9">
					          <input type="text" class="form-control" name="leaderName"/>
		                  	</div>
		                </div>
            		</div>
            	<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label">&nbsp;离场时间:</label>
		                  	<div class="col-sm-9">
					            <div class="input-group date">
				                  	<input type="text" class="form-control mydatepicker" readonly="readonly" name="leaveTime" />
				                  	<div class="input-group-addon">
				                    	<i class="fa fa-calendar"></i>
				                  	</div>
				                </div>
				            </div>
		                </div>
            		</div>
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;电话号码:</label>
		                  	<div class="col-sm-9">
					          <input type="text" class="form-control" name="telphone"/>
		                  	</div>
		                </div>
            		</div>
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;身份证号:</label>
		                  	<div class="col-sm-9">
					          <input type="text" class="form-control" name="idNumber"/>
		                  	</div>
		                </div>
            		</div>
            	</div>
            </div>
            <!-- /.box-body -->
        </div>
		           
		             
         <div class="box box-default box-solid" style="margin-bottom:5px;">
            <div class="box-header with-border">
              	<h3 class="box-title">材料管理</h3>
              	<div class="box-tools pull-right">
                	<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                	</button>
             	</div>
              	<!-- /.box-tools -->
            </div>
            <!-- /.box-header -->
            <div class="box-body" style="display: block;">
            	<table class="table table-bordered">
	                <tr>
	                  <th style="width: 10px">序</th>
	                  <th>电子件名称</th>
	                  <th>电子件列表(点击查看)</th>
	                  <th>说明</th>
	                  <th width="100">管理</th>
	                </tr>
	                <tbody>
		                <tr th:each="folder:${projectTeamFolders}" name="folder_tr" th:attr="field=${folder.id}">
		                  <td th:text="${folderStat.count}"></td>
		                  <td th:text="${folder.folderName}"></td>
		                  <td name="pt_annexes_td">无</td>
		                  <td th:text="${folder.remark}"></td>
		                  <td><a href="javascript:" th:onclick="'fnEditAnnex(this,'+${folder.id}+',\''+${folder.folderName}+'\')'">扫描件管理</a></td>
		                </tr>
	                </tbody>
              	</table>
            </div>
        </div>
		           
				 </form>
				</div>
				<div class="modal-footer">
					 <button id="btnSubmit" type="button" onclick="doSave()" class="btn btn-primary" style="width:80px;">保存</button>
					 <button type="button" class="btn btn-default" data-dismiss="modal" style="width:80px;">关闭</button> 
				</div>
			</div>
		</div>
	</div>
	
	<!-- 新增 编辑模态框结束 -->

	 <!-- 查看模态框开始 -->
    <div class="modal fade" id="viewModal" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" aria-hidden="true">
		<div class="modal-dialog" style="width:900px;">
			<div class="modal-content">
				<div class="modal-header">
				 	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h5 class="modal-title">项目班组查看</h5>
				</div>
	<div class="modal-body" style="overflow: hidden; padding: 10px;">
	  <form class="form-horizontal" id="viewForm" name="viewForm">
        <div class="box box-default box-solid" style="margin-bottom:5px;">
            <div class="box-header with-border">
              	<h3 class="box-title">单位基本信息</h3>
              	<div class="box-tools pull-right">
                	<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                	</button>
             	</div>
            </div>
            <div class="box-body" style="display: block;">
            	<div class="row">
            		<div class="col-md-6">
            			<div class="form-group">
            			<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;单位名称:</label>
		              <div class="col-sm-9">
		                    <input type="text"  name="companyName" id="myCompanyName" readonly="true"/>
					      </div>
		                </div>
            		</div>
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-5 control-label"><i style="color:red;">*</i>&nbsp;统一社会信用代码:</label>
		                  	<div class="col-sm-7">
	                    		<input type="text"  name="socialCreditCode" id="social_creditcode" readonly="true"/>
		                  	</div>
		                </div>
            		</div>
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;单位类型:</label>
		                  	<div class="col-sm-9">
		                 <input type="text"  name="useunitTypeName" id="useunit_type" readonly="true"/>
		                  	</div>
		                </div>
            		</div>
            	</div>
            </div>
        </div> 
        	       
        <div class="box box-default box-solid" style="margin-bottom:5px;">
            <div class="box-header with-border">
              	<h3 class="box-title">项目班组信息</h3>
              	<div class="box-tools pull-right">
                	<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                	</button>
             	</div>
              	<!-- /.box-tools -->
            </div>
            <!-- /.box-header -->
            <div class="box-body" style="display: block;">
              	<div class="row">
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;班组名称:</label>
		                  	<div class="col-sm-9">
	                    		<input type="text"  name="teamName" readonly="true"/>
		                  	</div>
		                </div>
            		</div>
         		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;入场时间:</label>
		                  	<div class="col-sm-9">
	                    		<div class="input-group">
				                  	<input type="text"  readonly="true" name="admissionTime" />
				                  
				                </div>
				          	</div>
		                </div>
            		</div> 
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;组长名称:</label>
		                  	<div class="col-sm-9">
					                <input type="text" name="leaderName" readonly="true"/>
					                
		                  	</div>
		                </div>
            		</div>
            	<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;离场时间:</label>
		                  	<div class="col-sm-9">
					            <div class="input-group">
				                  	<input type="text"  readonly="true" name="leaveTime" />
				                </div>
				            </div>
		                </div>
            		</div>
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;电话号码:</label>
		                  	<div class="col-sm-9">
		                  		
					                <input type="text"  name="telphone" readonly="true"/>
					                
		                  	</div>
		                </div>
            		</div>
            		<div class="col-md-6">
            			<div class="form-group">
		                  	<label class="col-sm-3 control-label"><i style="color:red;">*</i>&nbsp;身份证号:</label>
		                  	<div class="col-sm-9">
					                <input type="text"  name="idNumber" readonly="true"/>
		                  	</div>
		                </div>
            		</div>
            	</div>
            </div>
            <!-- /.box-body -->
        </div>
		           
		             
         <div class="box box-default box-solid" style="margin-bottom:5px;">
            <div class="box-header with-border">
              	<h3 class="box-title">材料管理</h3>
              	<div class="box-tools pull-right">
                	<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                	</button>
             	</div>
              	<!-- /.box-tools -->
            </div>
            <!-- /.box-header -->
            <div class="box-body" style="display: block;">
            	<table class="table table-bordered">
	                <tr>
	                  <th style="width: 10px">序</th>
	                  <th>电子件名称</th>
	                  <th>电子件列表(点击查看)</th>
	                  <th>说明</th>
	                </tr>
	                <tbody>
		                <tr th:each="folder:${projectTeamFolders}" name="folder_tr2" th:attr="field=${folder.id}">
		                  <td th:text="${folderStat.count}"></td>
		                  <td th:text="${folder.folderName}"></td>
		                  <td name="pt_annexes_td2">无</td>
		                  <td th:text="${folder.remark}"></td>
		                </tr>
	                </tbody>
              	</table>
            </div>
        </div>
		           
				 </form>
				</div>
			</div>
		</div>
	</div>
	
	<!-- 查看模态框结束 -->
	
</body>
<!-- jQuery 2.2.3 -->
<script th:src="@{/static/plugins/jQuery/jquery-2.2.3.min.js}"></script>
<!-- Bootstrap 3.3.7 -->
<script th:src="@{/static/bootstrap/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/common.js}"></script>
<script th:src="@{/static/plugins/bootstrap-validator/js/bootstrapValidator.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js}"></script>
<script th:src="@{/static/plugins/jQuery/jquery.serializejson.min.js}"></script>
<script th:src="@{/static/plugins/datepicker/bootstrap-datepicker.js}"></script>
<script th:src="@{/static/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/extensions/export/bootstrap-table-export.min.js}"></script>
<!-- 窗口收缩工具 -->
<script type="text/javascript" th:src="@{/static/dist/js/app.min.js}"></script>
<script th:inline="javascript" type="text/javascript">
/*<![CDATA[*/
	var CTX = [[@{/}]];
	var STATIC = [[@{/static/}]];
	
	$(window).resize(function(){
		$('#dataList').bootstrapTable('refreshOptions',{
			height:$(window).height()-80
		});
		$('.search input').attr('placeholder','班组名称');
	});
	function fnResetTable(){
		window.setTimeout(function(){
			$('#dataList').bootstrapTable('resetView');
		},500);
	}
	$(function () {
	    //1.初始化Table
	    var oTable = new TableInit();
	    oTable.Init();

	    //2.初始化Button的点击事件
	    var oButtonInit = new ButtonInit();
	    oButtonInit.Init();

	    //初始化时间控件
	    $('.mydatepicker').datepicker({
	    	format:"yyyy-mm-dd",
	    	language:"zh-CN",
	    	todayHighlight:true,
	    	autoclose: true,
	    	clearBtn: true,
	    	}).on('hide',function(){
				if($(this).val()!=''){
					var bootstrapValidator = $("#myform").data('bootstrapValidator');  
				    bootstrapValidator.updateStatus($(this).attr('name'), 'NOT_VALIDATED').validateField($(this).attr('name'));
				}
			});
	    
	    $('#myform').bootstrapValidator({
			message: '此处输入有误',
	        excluded: [':disabled'],
	        feedbackIcons: {
	            valid: 'glyphicon glyphicon-ok',
	            invalid: 'glyphicon glyphicon-remove',
	            validating: 'glyphicon glyphicon-refresh'
	        },
	        fields:{
	        	'teamName':{
	        		message: '班组名称输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '班组名称不可为空'
	                    }
	                }
	        	},
	        	'admissionTime':{
	        		message: '入场时间输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '入场时间不可为空'
	                    }
	                }
	        	},
	        	'leaderName':{
	        		message: '组长名称输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '组长名称不可为空'
	                    }
	                }
	        	},
	        	'telphone':{
	        		message: '电话号码输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '电话号码不可为空'
	                    },
	                    regexp:{
	                    	regexp: /(^(\d{3,4}-)?\d{7,8})$|(1[3|4|5|7|8|9][0-9]{9})$/,
	                    	message: '号码格式错误(如:0000-0000000 或 13800000000)'
	                    }
	                }
	        	},
	        	'idNumber':{
	        		message: '身份证号输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '身份证号不可为空'
	                    },
	                    stringLength: {
	                        min: 15,
	                        max: 18,
	                        message: '身份证不少于15位,不高于18位'
	                    }
	                }
	        	},
	        	'companyName':{
	        		message: '单位名称输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '单位名称不可为空'
	                    }
	                }
	        	},
	        	'socialCreditCode':{
	        		message: '统一社会信用代码输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '统一社会信用代码不可为空'
	                    }
	                }
	        	},
	        	'useunitType.id':{
	        		message: '单位类型输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '单位类型不可为空'
	                    }
	                }
	        	}
	        }
		});
	    
	  	/* 初始化隐藏select的div层 */
		 $('.my-select').hide();
	  
	    /* 判断输入框是否改变 */
	    $("#myCompanyName").on('input propertychange',function(){
	    	$("#social_creditcode").attr("readonly",false); 
			$("#social_creditcode").val('');
			$("#useunitType option:first").prop("selected", 'selected');
		 	var bootstrapValidator = $("#myform").data('bootstrapValidator');  
		    bootstrapValidator.updateStatus('socialCreditCode', 'NOT_VALIDATED').validateField('socialCreditCode');
	    });
	    
	  	//编辑表单窗口关闭事件
	    $('#addModal').on('hidden.bs.modal',function(){
	    	//重置表单
	    	fnResetProjectStatusForm();
	    });
	  	//查看窗口关闭事件
	    $('#viewModal').modal('hidden.bs.modal',function(){
	    	$('#viewForm')[0].reset();
	    	$('#viewForm').find("td[name='pt_annexes_td2']").html('无');
	    });
	});
	
	//初始化列表
	var TableInit = function () {
	    var oTableInit = new Object();
	    //初始化Table
	    oTableInit.Init = function () {
	        $('#dataList').bootstrapTable({
	        	url: CTX + 'project-team/query-project-team-page',         //请求后台的URL（*）
	            method: 'get',                      //请求方式（*）
	            toolbar: '#toolbar',                //工具按钮用哪个容器
	            //toolbarAlign:'left',				//工具栏位置
	            striped: true,                      //是否显示行间隔色
	            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
	            pagination: true,                   //是否显示分页（*）
	            sortable: false,                     //是否启用排序
	            sortOrder: "asc",                   //排序方式
	            queryParams: oTableInit.queryParams,//传递参数（*）
	            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
	            pageNumber:1,                       //初始化加载第一页，默认第一页
	            pageSize: 10,                       //每页的记录行数（*）
	            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
	            queryParamsType: "a",
	            search: true,                       //是否显示表格搜索
	            strictSearch: true,
	            showColumns: true,                  //是否显示所有的列
	            showRefresh: true,                  //是否显示刷新按钮
	            minimumCountColumns: 2,             //最少允许的列数
	            clickToSelect: true,                //是否启用点击选中行
	            height: $(window).height()-80,      //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
	            uniqueId: "id",                     //每一行的唯一标识，一般为主键列
	            showToggle:true,                    //是否显示详细视图和列表视图的切换按钮
	            cardView: false,                    //是否显示详细视图
	            detailView: false,                  //是否显示父子表
	            showExport: false,                     //是否显示导出
	            exportDataType: "basic",              //basic', 'all', 'selected'.
	            exportTypes:[ 'excel','doc', 'xml','csv','json'],  //导出文件类型
	            exportOptions:{  
	                ignoreColumn: [0],  //忽略某一列的索引 ,如 [0,1]
	                fileName: '项目班组导出',  //文件名称设置  
	                worksheetName: '信息',  //表格工作区名称  
	                tableName: '项目班组导出文件'
	            },
	            columns: [
				{
	            	checkbox:true
		        },{
				    field: 'companyName',
				    title:'单位名称',
				    align : 'center',
				    sortable:true
				},{
				    field: 'useunitType',
				    title:'单位类型',
				    align : 'center',
				    sortable:true
				},{
				    field: 'teamName',
				    title:'班组名称',
				    align : 'center',
				    sortable:true
				},{
				    field: 'admissionTime',
				    title:'入场时间',
				    align : 'center',
				    sortable:true,
				    formatter:function(v){
				    	if(v==null||v==''){return null;}
				    	return new Date(v).Format('yyyy-MM-dd');
				    }
				},{
				    field: 'leaveTime',
				    title:'离场时间',
				    align : 'center',
				    sortable:true,
				    formatter:function(v){
				    	if(v==null||v==''){return null;}
				    	return new Date(v).Format('yyyy-MM-dd');
				    }
				},{
				    field: 'status',
				    title:'当前状态',
				    align : 'center',
				    sortable:true,
				    formatter:function(value){
				    	if(value == 1){
				    		return '入场';
				    	}else if(value==2)
				    		return '离场';
				    	else
				    		return null;
				    }
				},{
					field : 'operate',
					title : '操作',
					align : 'center',
					valign : 'middle',
					clickToSelect : false,
                    formatter: function (value, row, index) {
                    	var operateHtml = '<button class="btn btn-box-tool" type="button" onclick="doShowDetail(\''+row.id+'\')" style=" background: none; border:none;"><i class="glyphicon glyphicon-search icon-search"></i></button>';
                    	operateHtml = operateHtml + '<button class="btn btn-box-tool" type="button" onclick="doEdit(\''+row.id+'\')" style=" background: none; border:none;"><i class="glyphicon glyphicon-edit icon-edit " ></i></button>';
                    	operateHtml = operateHtml + '<button class="btn btn-box-tool" type="button" onclick="doDelete(\''+row.id+'\')" style=" background: none; border:none;"><i class="glyphicon glyphicon-remove icon-remove" style="color:red;"></i></button>';
                        return operateHtml;
                    }
				}]
	        });
	        $('.search input').attr('placeholder','班组名称');
	    };

	    //得到查询的参数
	    oTableInit.queryParams = function (params) {
	    	var data = JSON.stringify($('#formSearch').serializeJSON());
	        var temp = {   //这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
	    		pageNum: params.pageNumber,//页码params.offset
                size: params.pageSize,//页面大小params.limit
                companyName:$("#formSearch input[id='queryCompanyName']").val(),
	            contentType:$("#formSearch select[id='useunitTypeId']").val(),
	            teamName:$("#formSearch input[id='queryTeamName']").val(),
	            projectInfoId: $("#formSearch input[id='projectInfoId']").val(),
	            search:params.searchText
	        };
	        return temp;
	    };
	    return oTableInit;
	};
	
	//初始化按钮
	var ButtonInit = function () {
	    var oInit = new Object();
	    var postdata = {};

	    oInit.Init = function () {
	        //初始化页面上面的按钮事件
	    };

	    return oInit;
	};
	
	//查询-刷新
	var queryInfo = function(){
		var data = JSON.stringify($('#formSearch').serializeJSON());
		var queryData = {from: data};
		$('#dataList').bootstrapTable('refresh',{pageNumber:1,pageSize:10,query:queryData});
	}
	
	
	$('#toolbar button').on('click',function(){
		//新增
		if($(this).attr('id')=='btn_add'){
			$('#addModal').find('.modal-title').html('新增项目组');
			$('#addModal').modal('toggle');
		}
		
		//删除
		if($(this).attr('id')=='btn_delete'){
			doDelete();
		}
	});
	
	//重置表单数据
	function fnResetProjectStatusForm(){
		$('#myform').bootstrapValidator('resetForm', true);
		$('#myform').find("input[name='id']").val('');
		$('#myform').find("input[name='annexIds']").val('');
		$('#myform').find("input[name='leaveTime']").val('');
		$('#myform').find("select[name='useunitType.id'] option:first").prop("selected", 'selected');
		$('#myform').find("td[name='pt_annexes_td']").html('无');
	}
	
	//选择
	var btnSelect = function(){
		   //展开和收起div层
	       $(".my-select").slideToggle();
	}
	var Selected = function(that){
		  //展开和收起div层
	    $(".my-select").slideToggle();
	   	var companyName=that.getAttribute("data-name");
		var socialCreditCode=that.getAttribute("data-socialCreditCode");
		var companyTypeId=that.getAttribute("data-type");
		$('#myform').find("input[name='companyName']").val(companyName);
		$('#myform').find("input[name='socialCreditCode']").val(socialCreditCode);
		$('#myform').find("select[name='useunitType.id']").val(companyTypeId);
	    $("#social_creditcode").attr("readonly",true); 
	    //$("#useunitType").attr("readonly",true);
	    //手动验证
	    var bootstrapValidator = $("#myform").data('bootstrapValidator');  
	    bootstrapValidator.updateStatus('companyName', 'NOT_VALIDATED').validateField('companyName');
	    bootstrapValidator.updateStatus('socialCreditCode', 'NOT_VALIDATED').validateField('socialCreditCode');
	}
	
	
	
	//编辑
	var doEdit = function(id){
		$('#addModal').find('.modal-title').html('编辑项目组');
		$('#addModal').modal('toggle');
		$.ajax({
			url:CTX+'project-team/get-project-team',
			type:'GET',
			data:{id:id},
			dataType:'json',
			timeout: 10000,
			success:function(json){
				if(json){
					var pt = json.projectTeam;
					$('#myform').find("input[name='id']").val(pt.id);
					$('#myform').find("input[name='annexIds']").val(pt.annexIds);
					$('#myform').find("input[name='companyName']").val(pt.companyName);
					$('#myform').find("input[name='socialCreditCode']").val(pt.socialCreditCode);
					$('#myform').find("input[name='teamName']").val(pt.teamName);
					$('#myform').find("input[name='admissionTime']").val(new Date(pt.admissionTime).Format('yyyy-MM-dd'));
					$('#myform').find("input[name='leaveTime']").val((pt.leaveTime!=null&&pt.leaveTime!='')?new Date(pt.leaveTime).Format('yyyy-MM-dd'):'');
					$('#myform').find("input[name='leaderName']").val(pt.leaderName);
					$('#myform').find("input[name='idNumber']").val(pt.idNumber);
					$('#myform').find("input[name='telphone']").val(pt.telphone);
					$('#myform').find("select[name='useunitType.id']").val(pt.useunitType.id);
					if(json.annexes!=null){
						//遍历班组电子文件每一行tr，再一一写入
						$("tr[name='folder_tr']").each(function(){
							var htmlStr = '';
							var trEl = $(this);
							$.each(json.annexes,function(i,annex){
								if(trEl.attr('field')==annex.annexFolder.id){
									htmlStr +=
										'<p>'+
						              	'	<input type="hidden" name="pt_fieldIds" value="'+annex.id+'"/>'+
						              	'	<a href="javascript:window.top.openCommonViewImgWin(\''+annex.id+'\')">'+annex.name+'.'+annex.extendName+'</a>'+
						              	'</p>';
								}
							});
							trEl.find("td[name='pt_annexes_td']").html(htmlStr==''?'无':htmlStr);
						});
					}else{
						$('#myform').find("td[name='pt_annexes_td']").html('无');
					}

				}
			},
			error:function(){
				alert('请求超时或系统出错!');
			}
		});
	}
	
	
	//查看
	var doShowDetail = function(id){
		$('#viewModal').find('.modal-title').html('显示项目组信息');
		$('#viewModal').modal('toggle');
		$.ajax({
			url:CTX+'project-team/get-project-team',
			type:'GET',
			data:{id:id},
			dataType:'json',
			//timeout: 10000,
			success:function(json){
				if(json){
					var pt = json.projectTeam;
					$('#viewForm').find("input[name='companyName']").val(pt.companyName);
					$('#viewForm').find("input[name='socialCreditCode']").val(pt.socialCreditCode);
					$('#viewForm').find("input[name='teamName']").val(pt.teamName);
					$('#viewForm').find("input[name='admissionTime']").val(new Date(pt.admissionTime).Format('yyyy-MM-dd'));
					$('#viewForm').find("input[name='leaveTime']").val((pt.leaveTime!=null&&pt.leaveTime!='')?new Date(pt.leaveTime).Format('yyyy-MM-dd'):'');
					$('#viewForm').find("input[name='leaderName']").val(pt.leaderName);
					$('#viewForm').find("input[name='idNumber']").val(pt.idNumber);
					$('#viewForm').find("input[name='telphone']").val(pt.telphone);
					$('#viewForm').find("input[name='useunitTypeName']").val(pt.useunitType.typeName);
					if(json.annexes!=null){
						//遍历班组电子文件每一行tr，再一一写入
						$("tr[name='folder_tr2']").each(function(){
							var htmlStr = '';
							var trEl = $(this);
							$.each(json.annexes,function(i,annex){
								if(trEl.attr('field')==annex.annexFolder.id){
									htmlStr +=
										'<p>'+
						              	'	<a href="javascript:window.top.openCommonViewImgWin(\''+annex.id+'\')">'+annex.name+'.'+annex.extendName+'</a>'+
						              	'</p>';
								}
							});
							trEl.find("td[name='pt_annexes_td2']").html(htmlStr==''?'无':htmlStr);
						});
					}else{
						$('#viewForm').find("td[name='pt_annexes_td2']").html('无');
					}

				}
			},
			error:function(){
				alert('请求超时或系统出错!');
			}
		});
	}
	

	//删除
	var doDelete = function(id){
		var delIds = '';
		if(id){
			delIds = id;
		}else{
			var seldatas = $('#dataList').bootstrapTable('getSelections');
			if(seldatas.length>0){
				$.each(seldatas,function(i,seldata){
					delIds += ','+seldata.id;
				});
				delIds = delIds.substring(1);
			}
		}
		if(delIds == ''){
			alert('未选择删除项');
			return;
		}
		if(window.confirm('确定要删除所选项吗?')){
			loading('正在删除,请稍后...');
			$.ajax({
				url:CTX+'project-team/delete-project-team',
				type:'POST',
				data:{ids:delIds},
				dataType:'json',
				success:function(json){
					loaded();
					if(json.success){
						alert(json.msg);
						queryInfo();
					}else{
						alert(json.msg);
					}
				},
				error:function(){
					alert('请求超时或系统出错!');
					loaded();
				}
			});
		}
	}
			
	
	//保存
	function doSave(){
		var result = $('#myform').data('bootstrapValidator');
		result.validate();
		if(result.isValid()){
			var admissionTime = $('#myform').find("input[name='admissionTime']").val();
			var leaveTime = $('#myform').find("input[name='leaveTime']").val();
			if(leaveTime!=null&&leaveTime!=''){
				admissionTime = admissionTime.replace(new RegExp("-","gm"),"/");
				leaveTime = leaveTime.replace(new RegExp("-","gm"),"/");
				var adTimes = (new Date(admissionTime)).getTime();
				var leTimes = (new Date(leaveTime)).getTime();
				if(leTimes<=adTimes){
					alert('离场时间必须大于进场时间');
					return;
				}
			}
			loading('正在保存,请稍后...');
			$.ajax({  
				url: CTX+'project-team/save-project-team',
	            type: 'POST',  
	            data:$('#myform').serialize(),// 序列化表单值  
	            dataType: 'json',//服务端接收的数据类型
	            success:function(json) {  
	            	loaded();
					if(json.success){
						alert(json.msg);
						queryInfo();
						$("#addModal").modal('hide');
					}else{
						alert(json.msg);
					}
	            },  
	            error:function(json) {  
	            	alert('请求超时或系统出错!');
					loaded();
	            }  
	        });  
		}
	}
	
	//班组信息-扫描件管理
	function fnEditAnnex(tdEl,folderId,folderName){
		var annexIdStr = '';
		var fields_tdEl = $(tdEl).parent().prev().prev();
		if(fields_tdEl.find("input[name='pt_fieldIds']").length>0){
			fields_tdEl.find("input[name='pt_fieldIds']").each(function(){
				annexIdStr += ','+$(this).val();
			});
			annexIdStr = annexIdStr.substring(1);
		}
		//调用统一附件管理页面
		window.top.openUploadAnnexWin({
			folderId:folderId,
			folderName:folderName,
			annexIds:annexIdStr
		},function(data){
			//附件管理回调
			if(data.length>0){
				var htmlStr = '';
				$.each(data,function(i,annex){
					htmlStr += 
						'<p>'+
		              	'	<input type="hidden" name="pt_fieldIds" value="'+annex.id+'"/>'+
		              	'	<a href="javascript:window.top.openCommonViewImgWin(\''+annex.id+'\')">'+annex.name+'.'+annex.extendName+'</a>'+
		              	'</p>';
				});
				fields_tdEl.html(htmlStr);
			}else{
				fields_tdEl.html('无');
			}
			
			if($("input[name='pt_fieldIds']").length>0){
				var annexIdStr = '';
				$("input[name='pt_fieldIds']").each(function(){
					annexIdStr += ','+$(this).val();
				});
				$('#myform').find("input[name='annexIds']").val(annexIdStr.substring(1));
			}else{
				$('#myform').find("input[name='annexIds']").val('');
			}
			//单独保存附件字段(可选，也可提交整个表单保存)
			fnSaveProjectTeamAnnexes();
		});
	}
	
	function fnSaveProjectTeamAnnexes(){
		var projectTeamId = $('#myform').find("input[name='id']").val();
		if(projectTeamId!=''){
			var annexIds = $('#myform').find("input[name='annexIds']").val();
			$.ajax({
				url: CTX+'project-team/save-project-team-annexes',
				type: 'post',
				dataType: 'json',
				data: {projectTeamId:projectTeamId,annexIds:annexIds},
				timeout: 10000,
				success: function(json){
					if(json.success){}
				},
				error: function(){
					alert('请求超时或系统出错!');
				}
			});
		}
	}
/*]]>*/
</script>	
</html>
