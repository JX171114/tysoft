<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--
* @Copyright(c): 厦门路桥信息股份有限公司  版权所有
* @author :XMRBI
* @Description:区域参建单位
* @createDate:2018-5-22
-->
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
    <title>项目角色分配</title>
    <link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/css/common.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/select2/select2.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-validator/css/bootstrapValidator.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/skins/_all-skins.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/jvectormap/jquery-jvectormap-1.2.2.css}"/>
    <!-- datetime picker -->
    <link rel="stylesheet" th:href="@{/static/plugins/datetimepicker/css/bootstrap-datetimepicker.min.css}"/>
    <!-- iCheck for checkboxes and radio inputs -->
    <link rel="stylesheet" th:href="@{/static/plugins/iCheck/all.css}"/>
    <!-- daterange picker -->
    <link rel="stylesheet" th:href="@{/static/plugins/daterangepicker/daterangepicker.css}"/>
    <!-- Theme style -->
    <link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/skins/_all-skins.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/css/common.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.css}"/>
    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/datepicker/datepicker3.css}"/>
	<style type="text/css">
        html, body {
            overflow-x: hidden;
        }

        body {
            padding-top: 5px;
        }

        .up_icon {
            width: 80px;
            height: 80px;
            float: left;
            position: relative;
            text-align: center;
            cursor: pointer;
            background: #ddd;
            border-radius: 5px;
        }

        .up_icon img {
            max-height: 100%;
        }

        .up_icon span {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20px;
            line-height: 20px;
            background: #8e8e8e;
            text-align: center;
            color: #fff;
            font-size: 12px;
            border-radius: 0px 0px 6px 6px;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .col-sm-10 span {
            word-break: break-all;
            word-wrap: break-word;
            white-space: normal;
            display: block;
            float: left;
            height: 34px;
            padding: 6px 12px 6px 0px;
            font-size: 14px;
            line-height: 1.42857143;
            color: #777;
        }
        
        #roleTableContent {
        word-break:break-all;
        word-wrap:break-all;
        }

    </style>
</head>
<body>
<div class="container-fluid" style="width:100%; height: 100%" >
    <!-- 左侧单位列表-->
    <div class="col-sm-3">
        <div class="row">
          <div class="box-header with-border" style="background-color: #d2d6de;">
              <h3 class="box-title" id="companyName"><i class="fa fa-user"></i>&nbsp;&nbsp;单位列表</h3>
         </div>
        </div>
        <!-- 单位列表树-->
         <div class="row">
             <div id="MenuTrees" data-toggle="context" data-target="#context-menu"></div>
         </div>
    </div>

  <!-- 右侧信息-->
  <div class="col-sm-9">
        <div id="roleTable">
            <div class="box box-default collapsed-box box-solid" style="margin-bottom:5px;">
                <div class="box-header with-border">
                <input id="useunitid" type="hidden" /> 
                    <h3 class="box-title"><span id="roleName">角色列表</span></h3>
                </div>
            </div>
            <table id="roleTableContent"></table>
        </div>
    </div>
</div>
	<!-- 选择项目 -->
	<div class="modal fade" id="selection_project_modal" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" aria-hidden="true">
		<div class="modal-dialog" style="width:95%;">
			<div class="modal-content">
				<div class="modal-header" style="text-align: center;background-color: #357ca5;">
				 	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h4 class="modal-title" style="color:white;">项目</h4>
				</div>
				<div class="modal-body" style="overflow: hidden; padding: 10px;">
				<form class="form-horizontal" id="selection_project_form">
					<input type="hidden" id="id" name="id" value=""/>
						<div class="box box-default box-solid" style="margin-bottom:5px;">
				            <div class="box-header with-border">
				              	<h3 class="box-title">已选择项目</h3>
				              	<!-- <button type="button" class="btn btn-primary" onclick="removeAllProjectre()" style="color: #FFFFFF;background: transparent;border:none;outline:none;">全部移除</button> -->
				              	<div class="box-tools pull-right">
				                	<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
				             	</div>
				              	<!-- /.box-tools -->
				            </div>
				            <!-- /.box-header -->
				            <div class="box-body" id="selected_project">
				            </div>
				        </div>
				        <div class="box box-default box-solid" style="margin-bottom:5px;">
				            <div class="box-header with-border">
				              	<h3 class="box-title">待选择项目</h3>
				              	<!-- /.box-tools -->
				            </div>
				            <!-- /.box-header -->
				            <div class="container-fluid" style="width:100%; height: 100%" >
				            <!-- 左侧项目列表-->
							    <div class="col-sm-2" style="background-color: #d2d6de;">
							        <div class="row">
							          <div class="box-header with-border" >
							              <h3 class="box-title" id="projectName"><i class="fa fa-align-left"></i>&nbsp;&nbsp;项目目录</h3>
							         </div>
							        </div>
							        <!-- 项目列表-->
							         <div class="row">
							             <div id="MenuTree" data-toggle="context" data-target="#context-menu"></div>
							         </div>
							    </div>
							  <!-- 右侧信息-->
							  <div class="col-sm-10">
						                <input type="hidden" id="projectGroupId" name="projectGroup.id" />
									  <table id="dataList"></table>
					           </div>
				             </div>
				        </div>
	            	</form>
				</div>
				<div class="modal-footer"  style="text-align: center">
					 <button id="btnSubmit" type="button" onclick="doSaveProject()" class="btn btn-primary" style="width:80px;">保存</button>
					 <button type="button" class="btn btn-default" data-dismiss="modal" style="width:80px;">关闭</button> 
				</div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript" th:src="@{/static/plugins/jQuery/jquery-2.2.3.min.js}"></script>
<script type="text/javascript" th:src="@{/static/bootstrap/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/select2/select2.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-validator/js/bootstrapValidator.min.js}"></script>
<script type="text/javascript" th:src="@{/static/js/common.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-contextmenu/bootstrap-contextmenu.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-contextmenu/prettify.js}"></script>
<script th:src="@{/static/plugins/bootstrap-validator/js/bootstrapValidator.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js}"></script>
<script th:src="@{/static/plugins/jQuery/jquery.serializejson.min.js}"></script>
<script th:src="@{/static/plugins/datepicker/bootstrap-datepicker.js}"></script>
<script th:src="@{/static/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/extensions/export/bootstrap-table-export.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/extensions/export/tableExport.js}"></script>
<!-- 窗口收缩工具 -->
<script type="text/javascript" th:src="@{/static/dist/js/app.min.js}"></script>
<script type="text/javascript" th:inline="javascript">
    var CTX = [[@{/}]];
</script>
<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/
    $(function () {
        //初始化单位列表树
        initMenuTrees();
      //初始化角色表格
        var roleTableInit = new RoleTableInit();
        roleTableInit.Init();
       
    });
   
    //初始化单位列表树
    function initMenuTrees() {
    	var r = Math.random().toString().substring(5);
        $.ajax({
            url: CTX + 'organizationManage/query-org-tree?Mathnum=' + r,
            method: 'GET',
            dataType: 'json',
            success: function (json) {
                $('#MenuTrees').treeview({
                    showTags: true,
                    data: json,
                    onNodeSelected: function(event, node) {
                        clickRoleTree(event, node);
                    }
                });
            },
            error: function () {
                loaded();
                alert('请求超时或系统出错');
            }
        });
    }

    //单位列表树节点选中事件
    function clickRoleTree(event, node) {
        $("#roleName").html(node.text);
        $("#useunitid").attr("value","");
        $("#useunitid").val(node.id);
        $("#roleTableContent").bootstrapTable('refresh');
    
    }

  //初始化单位列表表格
    var RoleTableInit = function () {
        var oTableInit = new Object();
        //初始化Table
        oTableInit.Init = function () {
            $('#roleTableContent').bootstrapTable({
                url: CTX + 'project-role/query-useunit-roles',         //请求后台的URL（*）
                method: 'get',                      //请求方式（*）
                toolbar: '#toolbar',                //工具按钮用哪个容器
                //toolbarAlign:'left',				//工具栏位置
                striped: true,                      //是否显示行间隔色
                cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                pagination: true,                   //是否显示分页（*）
                sortable: false,                     //是否启用排序
                sortOrder: "asc",                   //排序方式
                queryParams: oTableInit.queryParams,//传递参数（*）
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                       //初始化加载第一页，默认第一页
                pageSize: 10,                       //每页的记录行数（*）
                pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                queryParamsType: "a",
                search: false,                       //是否显示表格搜索
                strictSearch: false,
                showColumns: false,                  //是否显示所有的列
                showRefresh: false,                  //是否显示刷新按钮
                minimumCountColumns: 2,             //最少允许的列数
                clickToSelect: false,                //是否启用点击选中行
                height:$(window).height()-80,         //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                uniqueId: "id",                     //每一行的唯一标识，一般为主键列
                showToggle: false,                    //是否显示详细视图和列表视图的切换按钮
                cardView: false,                    //是否显示详细视图
                detailView: false,                  //是否显示父子表
                showExport: false,                     //是否显示导出
                exportDataType: "basic",              //basic', 'all', 'selected'.
                exportTypes: ['excel', 'doc', 'xml', 'csv', 'json'],  //导出文件类型
                exportOptions: {
                    ignoreColumn: [0],  //忽略某一列的索引 ,如 [0,1]
                    fileName: '现场人员信息导出',  //文件名称设置
                    worksheetName: '信息',  //表格工作区名称
                    tableName: '现场人员信息导出文件'
                },
                columns: [
                     {
                        field: 'roleName',
                        title: '角色',
                        sortable: false
                    }, {
                        field: 'systemUsers',
                        title: '包含用户',
                        sortable: false
                    },  {
                        field: 'projectInfos',
                        title: '包含项目',
                        sortable: false
                    },{
    					field : 'operate',
    					title : '操作',
    					align : 'center',
    					valign : 'middle',
    					clickToSelect : false,
                        formatter: function (value, row, index) {
                        	var operateHtml = '<button type="button" onclick="doSelect(\''+row.id+'\')" style=" background: none; border:none;"><i class="fa fa-edit" style="color:green;"></i>&nbsp;</button>';
                            return operateHtml;
                        }
    				}
                ]
            });
        };
        
        //得到查询的参数
        oTableInit.queryParams = function (params) {
            var temp = {   //这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
                pageNum: params.pageNumber,//页码params.offset
                size: params.pageSize,//页面大小params.limit
                order: params.sortOrder,//排序 params.order
                ordername: params.sortName,//排序字段 params.sort
                useunitId:$("#useunitid").val()
            };
            return temp;
        };
        return oTableInit;
    };
    
 	//选择项目
    var doSelect = function(id){
    	var url = CTX+'project-role/project-role-input.html?id='+id;
		window.parent.openCommonFrameWin(url,1080,$(window).height()-55,function(){
				$('#roleTableContent').bootstrapTable('refresh');
		});
      }
 	
    /*]]>*/
</script>
</html>