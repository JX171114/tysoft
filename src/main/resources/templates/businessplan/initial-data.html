<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--
* @Copyright(c): 厦门路桥信息股份有限公司  版权所有
* @author :XMRBI
* @Description:初始化上一年数据
* @createDate:2018-8-23
-->
<head>
	<meta charset="UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
	<title>初始化上一年数据</title>
	<link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/css/common.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/select2/select2.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-validator/css/bootstrapValidator.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/skins/_all-skins.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/jvectormap/jquery-jvectormap-1.2.2.css}"/>
    <!-- Theme style -->
	<link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/dist/css/skins/_all-skins.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/css/common.css}"/>
	<!-- Bootstrap 3.3.7 -->
	<link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.css}"/>
	<style type="text/css">
	.panel {
	  margin-bottom: 0px;
	}
	.form-group {
	  margin-bottom: 2px;
	}
	
	</style>
	<style type="text/css">
        html, body {
            overflow-x: hidden;
        }

        body {
            padding-top: 5px;
        }
        
        .box.box-solid.box-default>.box-header {
        	background-color: #DEF2FF;
        }
        
        .box.box-solid>.box-header .btn.btn-default{    
			background-color: #4A90E2;
		  	border-color: #4A90E2;
		  	color:#fff;
		}

        .col-sm-10 span {
            word-break: break-all;
            word-wrap: break-word;
            white-space: normal;
            display: block;
            float: left;
            height: 34px;
            padding: 6px 12px 6px 0px;
            font-size: 14px;
            line-height: 1.42857143;
            color: #777;
        }
        
		.search_div{
			padding: 0px;
			font-family: serif;
			/* line-height: 34px;
			margin-bottom: 0px; */
		}
		
		.list-group-item{
			padding: 5px 5px;
		}
		
		#search_div{
			padding: 0px;
		}
		
		#search_div .btn.btn-default{
			background-color: #fff;
		  	border-color: gray;
		  	color:#000;
		}
		
		.modal-header{
			background-color:#F4F6F8;
			border-top-left-radius: 5px;
			border-top-right-radius: 5px;
		}
		
		a{
			font-weight: bold;
			color: #000;
		}
		
		#compList>thead>tr>th{text-align: center;vertical-align: middle !important;}
		#compList>tbody>tr>td{vertical-align: middle !important;}
        
    </style>
</head>
<body>
<div class="container-fluid" style="width:100%; height: 100%" >
	<div class="box box-default collapsed-box box-solid" style="margin-bottom: 5px;border-color: #DEF2FF;">
	<input id="year" hidden="hidden" th:value="${year}" />
		<div class="box-header with-border">
			<div id="search_div">
		       <div class="col-md-4" style="padding: 0px;">
		       		<div class="form-group">
				    	<label class="col-sm-5 control-label search_div" style="width: 100px;height: 34px;margin: 0px;line-height: 34px;">选择月份:</label>
				    	<div class="col-sm-7 search_div" style="width: 170px;">
				            <select class="form-control" id="month">
						        <option value=""></option>
						        <option th:each="month : ${monthList}" th:value="${month}" th:text="${month}"></option>
					        </select>
				    	</div>
					</div>
		       </div>
		       <div class="col-md-2 btn-group" style="padding: 0px;">
					<button id="btn_edit" type="button" class="btn btn-default" onclick="fnEdit();">
						<span class="glyphicon glyphicon-pencil" aria-hidden="true" style="color: #18A689"></span>编辑
					</button>
					<button id="btn_refresh" type="button" class="btn btn-default" onclick="loadCompletion();">
						<span class="glyphicon glyphicon-refresh" aria-hidden="true" style="color: #EC4758"></span>刷新
					</button>
		        </div>
	        </div>
		</div>
	</div>
	
    <h3 align="center" th:text="${year} + ${'年各月指标发生情况'}" style="margin: 10px 0px;"></h3>
    <div id="table_container" class="container-fluid" style="padding: 0px;">
	    <table class="table table-bordered" style="width: 100%" id="compList">
		   	<thead>
		   		<tr align="center">
		   			<th></th>
		   			<th th:each="month : ${monthList}" th:text="${month} + ${'月'}" align="center"></th>
		   		</tr>
		   	</thead>
		   	<tbody id="compList_body">
		   	</tbody>
		 </table>
    </div>
</div>

</body>
<!-- jQuery 2.2.3 -->
<script th:src="@{/static/plugins/jQuery/jquery-2.2.3.min.js}"></script>
<!-- Bootstrap 3.3.7 -->
<script th:src="@{/static/bootstrap/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/common.js}"></script>
<script th:src="@{/static/plugins/bootstrap-validator/js/bootstrapValidator.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js}"></script>
<script th:src="@{/static/plugins/jQuery/jquery.serializejson.min.js}"></script>
<script th:src="@{/static/plugins/datepicker/bootstrap-datepicker.js}"></script>
<script th:src="@{/static/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/extensions/export/bootstrap-table-export.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-contextmenu/bootstrap-contextmenu.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-contextmenu/prettify.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/attention/zDialog/zDrag.js}"></script>
<!-- Slimscroll -->
<script type="text/javascript" th:src="@{/static/plugins/slimScroll/jquery.slimscroll.min.js}"></script>
<script type="text/javascript" th:src="@{/static/dist/js/app.min.js}"></script>
<script type="text/javascript" th:src="@{/static/js/common.js}"></script>
<script th:inline="javascript" type="text/javascript">
/*<![CDATA[*/
	var CTX = [[@{/}]];
	
	$(function () {
	    //初始化Button的点击事件
	    var oButtonInit = new ButtonInit();
	    oButtonInit.Init();
	    
	    //$('#table_container').height($(window).height()-110);
	  	//加载指标完成情况
	    loadCompletion();
	});
	
	//初始化按钮
	var ButtonInit = function () {
	    var oInit = new Object();
	    var postdata = {};

	    oInit.Init = function () {
	        //初始化页面上面的按钮事件
	    };

	    return oInit;
	};
	
	//打开编辑界面
	function fnEdit(){
		var year = $("#year").val();
		var month = $("#month").val();
		if(month == null || month == ''){
			alert("请选择月份！");
		}else{
			var url = CTX+'business-report/initial-month-data?year=' + year +"&month=" + month;
			window.parent.openCommonFrameWin(url,1000,$(window).height()-25,function(result){
				if(result){
					loadCompletion();
				}
			});
		}
	}
	
	//清除表格
	function cleanCompList_body(){
		var tbody = document.getElementById("compList_body");
		var children = tbody.childNodes;
		for(var i = children.length -1; i >= 0; i--){
			tbody.removeChild(children[i]);
		}
	}
	
	//加载指标完成情况
	function loadCompletion(){
		var r = Math.random().toString().substring(5);
        $.ajax({
            url: CTX + 'business-indicator/get-indicator-list?Mathnum=' + r,
            method: 'GET',
            dataType: 'json',
            data: {opt:"initialComp"},
            success: function (json) {
            	paintCompList_body(json);
            },
            error: function () {
                loaded();
                alert('请求超时或系统出错');
            }
        });
	}
	
	//加载指标每月数据
	function getDataList(indicatorId,row){
		var r = Math.random().toString().substring(5);
		var year = $("#year").val();
		$.ajax({
            url: CTX + 'indicator-completion/query-initial-data?Mathnum=' + r,
            method: 'GET',
            dataType: 'json',
            data: {year:year,indicatorId:indicatorId},
            success: function (json) {
            	addTd(json,row);
            },
            error: function () {
                alert('请求超时或系统出错');
                return null;
            }
        });
	}
	
	function addTd(objs,row){
		if(objs!=null && objs.length > 0){
			compList = objs[0].compList;
			for(var j = 0; j < 12; j++){
				var newCell1 = row.insertCell();
				newCell1.align = "center";
				var num_thisMonthAmount = "";
				if(compList!=null && compList[j] != null){
					num_thisMonthAmount = compList[j].thisMonthAmount==null || compList[j].thisMonthAmount=='null' ? "" : compList[j].thisMonthAmount;
				}
				newCell1.innerHTML = "<span>" + num_thisMonthAmount + "</span>";
			}
		}else{
			var newCell1 = row.insertCell();
			newCell1.innerHTML = "<span></span>";
		}
	}
	
	//绘制表格
	function paintCompList_body(indicatorList){
		cleanCompList_body();
		
		var tBody = document.getElementById("compList_body");
		
		for(var i=0,len=indicatorList.length; i<len; i++){
			var indicatorId = indicatorList[i].id;
			var blank = "";
			var indicNos = indicatorList[i].indicNo.split(".");
			if(indicNos.length > 0){
				for(var j=1,noLen=indicNos.length; j<noLen; j++){
					blank += "&emsp;";
				}
			}
			
			var newRow = tBody.insertRow();
			var newCell0 = newRow.insertCell();
			//指标名称
			newCell0.innerHTML = "<span>"+blank + indicatorList[i].indicNo + "&nbsp;" + indicatorList[i].indicName +"</span>";
			getDataList(indicatorId,newRow);
		}
	}
	
	
	/*]]>*/
</script>	
</html>
