<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--
* @Copyright(c): 厦门路桥信息股份有限公司  版权所有
* @author :XMRBI
* @Description:合同录入
* @createDate:2018-7-31
-->
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
	name="viewport" />
<title>合同录入</title>
<link rel="stylesheet"
	th:href="@{/static/bootstrap/css/bootstrap.min.css}" />
<link rel="stylesheet"
	th:href="@{/static/dist/css/font-awesome.min.css}" />
<link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}" />
<link rel="stylesheet" th:href="@{/static/css/common.css}" />
<link rel="stylesheet" th:href="@{/static/plugins/select2/select2.css}" />
<link rel="stylesheet"
	th:href="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.css}" />
<link rel="stylesheet"
	th:href="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.css}" />
<link rel="stylesheet"
	th:href="@{/static/plugins/bootstrap-validator/css/bootstrapValidator.min.css}" />
<link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.css}" />
<link rel="stylesheet"
	th:href="@{/static/dist/css/skins/_all-skins.min.css}" />
<link rel="stylesheet"
	th:href="@{/static/dist/css/font-awesome.min.css}" />
<link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}" />
<link rel="stylesheet"
	th:href="@{/static/plugins/jvectormap/jquery-jvectormap-1.2.2.css}" />
<!-- Theme style -->
<link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.min.css}" />
<link rel="stylesheet"
	th:href="@{/static/dist/css/skins/_all-skins.min.css}" />
<link rel="stylesheet" th:href="@{/static/css/common.css}" />
<!-- Bootstrap 3.3.7 -->
<link rel="stylesheet"
	th:href="@{/static/bootstrap/css/bootstrap.min.css}" />
<link rel="stylesheet"
	th:href="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.css}" />
<!-- bootstrap datepicker -->
<link rel="stylesheet"
	th:href="@{/static/plugins/datepicker/datepicker3.css}" />
<style type="text/css">
.panel {
	margin-bottom: 0px;
}

.form-group {
	margin-bottom: 2px;
}
</style>
<style type="text/css">
html, body {
	overflow-x: hidden;
}

body {
	padding-top: 5px;
}

.box.box-solid.box-default>.box-header {
	background-color: #DEF2FF;
}

.box.box-solid>.box-header .btn.btn-default {
	background-color: #4A90E2;
	border-color: #4A90E2;
	color: #fff;
}

.col-sm-10 span {
	word-break: break-all;
	word-wrap: break-word;
	white-space: normal;
	display: block;
	float: left;
	height: 34px;
	padding: 6px 12px 6px 0px;
	font-size: 14px;
	line-height: 1.42857143;
	color: #777;
}

.search_div {
	padding: 0px;
	font-family: serif;
	/* line-height: 34px;
			margin-bottom: 0px; */
}

.list-group-item {
	padding: 5px 5px;
}

#search_div {
	padding: 0px;
	margin: 10px 0px;
}

#search_div .btn.btn-default {
	background-color: #fff;
	border-color: gray;
	color: #000;
}

.modal-header {
	background-color: #F4F6F8;
	border-top-left-radius: 5px;
	border-top-right-radius: 5px;
}

a {
	font-weight: bold;
	color: #000;
}
</style>
</head>
<body>
<form action="" id="contractFrom" method="Post"></form>
	<div class="container-fluid" style="width: 100%; height: 100%">
		<!-- <div class="col-sm-12"> -->
		<div class="box box-default collapsed-box box-solid"
			style="margin-bottom: 5px; border-color: #DEF2FF;">
			<div class="box-header with-border">
				<form id="formSearch" class="form-horizontal">
					<div id="btn_div" class="" style="margin-bottom: 5px;">
						<button id="btn_issued" type="button"
							class="btn btn-default btn-primary" onclick="toIssuedContract()">
							<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
						</button>
						&emsp;
					</div>

					<div id="search_div" class="col-md-12">
						<div class="col-md-4" style="padding-right: 0px;">
							<div class="form-group">
								<label class="col-sm-3 control-label search_div"
									style="width: 100px;">合同名称:</label>
								<div class="col-sm-9 search_div" style="width: 170px;">
									<input type="text" class="form-control" id="contractName"
										name="contractName" value="" onkeyup="this.value=this.value.replace(/\s+/g,'')" />
								</div>
							</div>
						</div>

						<div class="col-md-4" style="padding: 0px;">
							<div class="form-group">
								<label class="col-sm-1 control-label search_div"
									style="width: 100px;">项目名称:</label>
								<div class="col-sm-9 search_div" style="width: 170px;">
									<input type="text" class="form-control" id="projectName"
										name="projectName" value="" onkeyup="this.value=this.value.replace(/\s+/g,'')" />
								</div>
							</div>
						</div>

						<div class="col-md-4" style="padding: 0px;">
							<div class="form-group">
								<input hidden="hidden" name="status" /> <label
									class="col-sm-3 control-label search_div" style="width: 100px;">合同状态:</label>
								<select id="contractStatus" name="contractStatus"
									class="form-control" style="width: 120px;">
									<option value=" "></option>
									<option value="拟稿">拟稿</option>
									<option value="流程进行中">流程进行中</option>
									<option value="流程已结束">流程已结束</option>
									<option value="流程已取消">流程已取消</option>
								</select>
							</div>
						</div>
					</div>
					<br />
					<br />

					<div id="search_div" class="col-md-12">
						<div class="col-md-4" style="padding-right: 0px;">
							<div class="form-group">
								<label class="col-sm-3 control-label search_div"
									style="width: 100px;">合同签约方:</label>
								<div class="col-sm-9 search_div" style="width: 170px;">
									<input type="text" class="form-control" id="signContractPeople"
										name="signContractPeople" value="" onkeyup="this.value=this.value.replace(/\s+/g,'')" />
								</div>
							</div>
						</div>

						<div class="col-md-4" style="padding: 0px;">
							<div class="form-group">
								<label class="col-sm-1 control-label search_div"
									style="width: 100px;">合同确定方式:</label>
								<div class="col-sm-9 search_div" style="width: 170px;">
								<select id="contractConfirmWay" name="contractConfirmWay"
									class="form-control" style="width: 170px;">
									<option value=" "></option>
									<option value="公开招标">公开招标</option>
									<option value="诚邀招标">诚邀招标</option>
									<option value="委托">委托</option>
									<option value="比选">比选</option>
									<option value="询价">询价</option>
									<option value="竞争性谈判">竞争性谈判</option>
									<option value="单一来源采购">单一来源采购</option>
									<option value="其他 ">其他</option>
								</select>
									<!-- <input type="text" class="form-control" id="contractConfirmWay"
										name="contractConfirmWay" value="" /> -->
								</div>
							</div>
						</div>
						<div class="col-md-4" style="padding: 0px;">
							&nbsp;&nbsp;&nbsp;&nbsp;
							<button id="btn_add" type="button" class="btn btn-default"
								onclick="queryInfo();">
								<span class="glyphicon glyphicon-search" aria-hidden="true"
									style="color: #18A689"></span>查询
							</button>
							&nbsp;&nbsp;&nbsp;&nbsp;
							<button id="btn_edit" type="button" class="btn btn-default"
								onclick="resetParams();">
								<span class="glyphicon glyphicon-repeat" aria-hidden="true"
									style="color: #EC4758"></span>重置
							</button>
							
							&nbsp;&nbsp;&nbsp;&nbsp;
							<button id="btn_edit" type="button" class="btn btn-default"
								onclick="refreshView();">
								<span class="glyphicon glyphicon-repeat" aria-hidden="true"
									style="color: #0066cc"></span>刷新
							</button>
						</div>
					</div>

				</form>
			</div>
		</div>

		<table id="dataList"></table>
		<!-- </div> -->
	</div>

	<!-- 增加合同的modal框 -->
	<div class="modal fade" id="addModal" role="dialog"
		aria-labelledby="myModalLabel" data-backdrop="static"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">×</button>
					<h4 id="modal_title" class="modal-title" style="color: blue;">合同类型</h4>
				</div>
				
				<div class="modal-body" style="overflow: hidden; padding: 10px;">

                    <br/><br/>
					<table id="projectList" class="table table-bordered"
						style="width: 100%">
						<thead>
							<tr align="center"> </tr>
						</thead>
						<tbody id="project_body">
							<tr height="36px;">
								<td align="center"><a href="javascript:void(0)"
									onclick="contractType(this)" title="钢材赊销、围挡、钢支撑、机电合同单" id="0">钢材赊销、围挡、钢支撑、机电合同单</a>
								</td>
								<td align="center"><a href="javascript:void(0)"
									onclick="contractType(this)" title="甲供三方合同单" id="1">甲供三方合同单</a>
								</td>
							</tr>

							<tr height="36px;">
								<td align="center"><a href="javascript:void(0)"
									onclick="contractType(this)" title="地铁甲供物资采购合同单" id="2">地铁甲供物资采购合同单</a>
								</td>

								<td align="center"><a href="javascript:void(0)"
									onclick="contractType(this)" title="办公室专用合同单" id="3">办公室专用合同单</a>
								</td>
							</tr>

							<tr height="36px;">
								<td align="center"><a href="javascript:void(0)"
									onclick="contractType(this)" title="财务部、贸管部通用合同单" id="4">财务部、贸管部通用合同单</a>
								</td>

								<td align="center"></td>
							</tr>
							
								<tr height="36px;">
								<td align="center"></td>
								<td align="center"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</body>
<!-- jQuery 2.2.3 -->
<script th:src="@{/static/plugins/jQuery/jquery-2.2.3.min.js}"></script>
<!-- Bootstrap 3.3.7 -->
<script th:src="@{/static/bootstrap/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/common.js}"></script>
<script
	th:src="@{/static/plugins/bootstrap-validator/js/bootstrapValidator.min.js}"></script>
<script
	th:src="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.js}"></script>
<script
	th:src="@{/static/plugins/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js}"></script>
<script th:src="@{/static/plugins/jQuery/jquery.serializejson.min.js}"></script>
<script th:src="@{/static/plugins/datepicker/bootstrap-datepicker.js}"></script>
<script
	th:src="@{/static/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js}"></script>
<script type="text/javascript"
	th:src="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.js}"></script>
<script
	th:src="@{/static/plugins/bootstrap-table/dist/extensions/export/bootstrap-table-export.min.js}"></script>
<script type="text/javascript"
	th:src="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.js}"></script>
<script type="text/javascript"
	th:src="@{/static/plugins/bootstrap-contextmenu/bootstrap-contextmenu.js}"></script>
<script type="text/javascript"
	th:src="@{/static/plugins/bootstrap-contextmenu/prettify.js}"></script>
<script type="text/javascript"
	th:src="@{/static/plugins/attention/zDialog/zDrag.js}"></script>
<!-- Slimscroll -->
<script type="text/javascript"
	th:src="@{/static/plugins/slimScroll/jquery.slimscroll.min.js}"></script>
<script type="text/javascript" th:src="@{/static/dist/js/app.min.js}"></script>
<script type="text/javascript" th:src="@{/static/js/common.js}"></script>
<script th:inline="javascript" type="text/javascript">
/*<![CDATA[*/
	var CTX = [[@{/}]];
	
	$(function () {
	    //1.初始化Table
	    var oTable = new TableInit();
	    oTable.Init();
	    //2.初始化Button的点击事件
	    var oButtonInit = new ButtonInit();
	    oButtonInit.Init();
	    //初始化时间控件
	    $('.datepicker').datepicker({
	    	format:'yyyy-mm',
	    	language:'zh-CN',
	      	autoclose: true,
	      	startView: 'months', //开始视图层，为月视图层
	        maxViewMode:'years', //最大视图层，为年视图层
	        minViewMode:'months', //最小视图层，为月视图层
	        clearBtn: true
	    }).on('hide',function(){
			
		});
	    
	});
	
	//初始化列表
	var TableInit = function () {
	    var oTableInit = new Object();
	    //初始化Table
	    oTableInit.Init = function () {
	        $('#dataList').bootstrapTable({
	        	url: CTX + 'contract/send-contract-enter-message', //请求后台的URL（*）
	            method: 'get',                      //请求方式（*）
	            striped: true,                      //是否显示行间隔色
	            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
	            pagination: true,                   //是否显示分页（*）
	            sortable: false,                     //是否启用排序
	            sortOrder: "asc",                   //排序方式
	            queryParams: oTableInit.queryParams,//传递参数（*）
	            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
	            pageNumber:1,                       //初始化加载第一页，默认第一页
	            pageSize: 10,                       //每页的记录行数（*）
	            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
	            queryParamsType: "a",
	            strictSearch: true,
	            minimumCountColumns: 2,             //最少允许的列数
	            height:$(window).height()-85,	    //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
	            uniqueId: "id",                     //每一行的唯一标识，一般为主键列
	            undefinedText: "",
	            columns: [
					{
					    field: 'number',
					    title:'序号',
					    align : 'center',
					    sortable:true,
					    formatter:function(value,row,index){
					    	var pageSize=$('#dataList').bootstrapTable('getOptions').pageSize;
			                var pageNumber=$('#dataList').bootstrapTable('getOptions').pageNumber;
			                return pageSize * (pageNumber - 1) + index + 1;
					    }
					},{
					    field: 'contractName',
					    title:'合同名称',
					    align : 'center',
					    sortable:true,
					    
					},{
					    field: 'projectName',
					    title:'项目名称',
					    align : 'center',
					    sortable:true
					},{
					    field: 'signContractPeople',
					    title:'合同签约方',
					    align : 'center',
					    sortable:true
					},{
					    field: 'contractStatus',
					    title:'状态',
					    align : 'center',
					    sortable:true
					},{
					    field: 'contractCreatPeople',
					    title:'创建人',
					    align : 'center',
					    sortable:true
					},{
					    field: 'contractCreatTime',
					    title:'创建时间',
					    align : 'center',
					    sortable:true
					},{
					    field: 'workFlow',
					    title:'合同进度',
					    align : 'center',
					    sortable:true,
					    formatter:function(v,r,i){
							return  '<a href="javascript:lookFlow(\'' + r.workFlow + '\')"><span class="glyphicon glyphicon-eye-open" aria-hidden="true" style="color: black ;"></span></a>';
		   				}
					},{
					    field: 'lookOperation',
					    title:'操作',
					    align : 'center',
					    sortable:true,
					    formatter:function(v,r,i){
							return  '<a href="javascript:reviseContract(\'' + r.id + '\',\'' + r.contractStatus + '\')" ><span class="glyphicon glyphicon-pencil" aria-hidden="true" style="color: black ;"></span></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:lookContract(\'' + r.id + '\')"><span class="glyphicon glyphicon-search" aria-hidden="true" style="color: blue ;"></span></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:deletContract(\'' + r.id + '\',\'' + r.contractStatus + '\')"><span class="glyphicon glyphicon-remove" aria-hidden="true" style="color:red ;"></span></a>';
		   				}
					},]
	        });
	      
	    };
	    //得到查询的参数
	    oTableInit.queryParams = function (params) {
	        var temp = {   //这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
	        	pageNum: params.pageNumber,//页码params.offset
                size: params.pageSize,//页面大小params.limit
                contractName: $("input[name='contractName']").val(),
                projectName: $("input[name='projectName']").val(),
                contractStatus: $("#contractStatus").val(),
                signContractPeople: $("input[name='signContractPeople']").val(),
                contractConfirmWay: $("#contractConfirmWay").val(),
                viewType:0,
	        };
	        return temp;
	    };
	    return oTableInit;
	};
	
	//初始化按钮
	var ButtonInit = function () {
	    var oInit = new Object();
	    var postdata = {};

	    oInit.Init = function () {
	        //初始化页面上面的按钮事件
	    };
	    return oInit;
	};
	
	//查询-刷新
	var queryInfo = function(){
		var data = JSON.stringify($('#formSearch').serializeJSON());
		var queryData = {from: data};
		$('#dataList').bootstrapTable('refreshOptions',{pageNumber:1,pageSize:10,query:queryData});
	}
	
	//重置参数
	function resetParams(){
		
		$("input[name=contractName]").val('');
		$("input[name=projectName]").val('');
		$("#contractStatus option:first").prop("selected", 'selected');
		$("input[name=signContractPeople]").val('');
	//	$("input[name=contractConfirmWay]").val('');
		$("#contractConfirmWay option:first").prop("selected", 'selected');
	}
	
	//打开查看页面
	function lookSupplier(id){
		var url = CTX+'supplier/get-supplier-message?id=' + id;
		window.parent.openCommonFrameWin(url,1000,$(window).height()-55,function(result){
			if(result){
				queryInfo();
			}
		});
	}
	
	//合同界面
	function contractType(contractTitle){
		$('#addModal').modal('toggle');
		var contractType=contractTitle.id;
		var contractTitle=contractTitle.title;
		//打开合同签订界面
			var url = CTX+'contract/sign-contract-view?contractType=' + contractType+"&contractTitle="+contractTitle;
			window.open(url);
			//$("#contractFrom").attr("action",url);
			//$("#contractFrom").submit(); 
		}
	
   //查看合同
	function lookContract(id){
		$("#contractFrom").attr("action",CTX+'contract/look-contract-view?id='+id)
	    $("#contractFrom").submit();
    }
   
   //修改合同-合同id和当前状态
   function reviseContract(id,state){
	if(state=="拟稿"){
		$("#contractFrom").attr("action",CTX+'contract/revise-contract-view?id='+id)
	    $("#contractFrom").submit();
	}else{
		alert("非拟稿状态,不允许修改");
		return;
	} 
   }
   
  //删除合同
    function  deletContract(id,state){
	    if(state=="拟稿"){
	    	$("#contractFrom").attr("action",CTX+'contract/delet-contract?id='+id)
		    $("#contractFrom").submit();
	    }else{
	    	alert("非拟稿状态,不允许删除");
			return;
	    }
  }
  
	//添加的模态框
	function toIssuedContract(){
		$('#addModal').modal('toggle');
	}
	
	//刷新界面
	function refreshView(){
		$("#contractFrom").attr("action",CTX+'contract/contract-enter')
	    $("#contractFrom").submit();
	}
	
	//查看流程图
 	function lookFlow(taskId){
		if(taskId=='not-exist'){
			alert('合同还未提交,请先提交');
			return;
		}
		
		window.open(CTX+'uflo/diagram?taskId='+taskId);
 	}
 	
	 
	    
	/*]]>*/
</script>
</html>
