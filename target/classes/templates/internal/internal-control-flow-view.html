<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--
* @Copyright(c): 厦门路桥信息股份有限公司  版权所有
* @author :XMRBI
* @Description:内控管理流程详情查看
* @createDate:2018-11-12
-->
<head>
	<meta charset="UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
	<title>流程详情</title>
	<link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/css/common.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/select2/select2.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-validator/css/bootstrapValidator.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/skins/_all-skins.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/jvectormap/jquery-jvectormap-1.2.2.css}"/>
    <!-- Theme style -->
	<link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/dist/css/skins/_all-skins.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/css/common.css}"/>
	<!-- Bootstrap 3.3.7 -->
	<link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.css}"/>
	<link th:href="@{/static/plugins/bootstrap-fileinput/css/fileinput.css}" media="all" rel="stylesheet" type="text/css"/>
	<link th:href="@{/static/plugins/bootstrap-fileinput/themes/explorer-fa/theme.css}" media="all" rel="stylesheet" type="text/css"/>
	<!-- bootstrap datepicker -->
  	<link rel="stylesheet" th:href="@{/static/plugins/datepicker/datepicker3.css}"/>
	<style type="text/css">
	.panel {
	  margin-bottom: 0px;
	}
	.form-group {
	  margin-bottom: 2px;
	}
	
	</style>
	<style type="text/css">
        html, body {
            overflow-x: hidden;
        }
        body {
            padding-top: 5px;
        }
        .box.box-solid.box-default>.box-header {
        	background-color: #F2F2F2;
        	padding: 3px 10px;
        }
        .btn-link:HOVER {
			text-decoration: none;
		}
		.modal-header{
			background-color:#F4F6F8;
			border-top-left-radius: 5px;
			border-top-right-radius: 5px;
		}
		.container-fluid{
			padding-right: 10px;
			padding-left: 10px;
		}
		#head_div{
			margin: 2px auto 0px;
			border-color: #F2F2F2;
			width: 1200px; 
		}
		
		#step_head_div{
			margin: 25px auto 0px;
			background-color: #E4E4E4;
			border: 1px solid #CCCCCC;
			width: 1170px;
		}
		#step_body_div{
			margin: 5px auto 15px;
			border: 1px solid #F2F2F2;
			width: 1170px;
		}
		#tab_div{
			margin: 10px auto 0px;
			width: 1200px;
		}
		.box-header>.btn-lg{
			padding: 5px 8px;
		}
		#content_div,#chart_div{
			width: 1200px;
			border: 1px solid #F2F2F2;
			margin: 0px auto;
		}
		#chart_div{
			min-height: 500px;
		}
		h2{
			text-align: center;
			margin: 20px 0px 15px;
		}
		#content_table{
			margin: 10px auto;
			border: 1px solid #F2F2F2;
			width: 1170px;
		}
		#content_table>td{
			padding-bottom: 15px;
		}
		#info_table{
			width: 1146px;
			margin: 0px auto;
		}
		#info_table>tbody>tr>td{
			border: 1px solid #C9C9C9;
			min-height: 32px;
			padding: 3px;
			font-size: 14px;
			text-align: center;
			vertical-align: middle;
		}
		.item_title{
			text-align: center;
			vertical-align: middle;
			background-color: #E4E4E4;
			width: 191px;
		}
		.item_content{
			width: 191px;
		}
		.table{
			border: 1px solid #C9C9C9;
			border-radius: 0px;
		}
		.table>thead>tr>th{
			background-color: #E4E4E4;
			border-left: none;
			border-right: none;
		}
		.table>tbody>tr>td{
			padding: 3px;
			vertical-align: middle;
			border-left: none;
			border-right: none;
		}
        #myTab li a{
        	font-size: 16px;
        	padding: 8px 15px;
        }
        .active>li>a{
        	color: blue;
        }
        #step_table{
        	/* width: 1130px; */
        	margin: 5px auto 15px;
        }
        .fixed-table-body{
        	border: none;
        }
        .a_tableName{
			text-decoration: underline;
			color: #000;
		}
          
    </style>
</head>
<body style="text-align: center;" id="print_body">
	<input id="flowId" name="flowId" type="hidden" th:value="${#strings.isEmpty(flow.id)} ? ${null} : ${flow.id}" />
	<input id="printType" name="printType" type="hidden" th:value="${printType}" />
	<input id="chartId" name="chartId" type="hidden" th:value="${flow.chartId}" />
	
	<div class="container-fluid" style="width:100%; height: 100%" >
		<div id="tab_div">
			<ul id="myTab" class="nav nav-tabs"><!--  style="background-color: #EDF1F5;" -->
				<li class="active">
					<a href="#detail_div" data-toggle="tab">基本信息</a>
				</li>
				<li>
					<a href="#chart_div" data-toggle="tab" onclick="fnLoadFlowChart();">流程图</a>
				</li>
			</ul>
		</div>
		
		<div id="myTabContent" class="tab-content">
			<div class="tab-pane fade in active" id="detail_div">
				<div id="head_div" class="box box-default collapsed-box box-solid">
				    <div class="box-header with-border" style="padding: 3px 8px;text-align: left;">
			        	<a th:if="${editAuth}" class='btn btn-lg btn-link' id="btn_change" style="color: blue;" onclick="fnEdit();">变更</a>
			            <a th:if="${editAuth}" class='btn btn-lg btn-link' id="btn_blockUp" style="color: red;" onclick="setStatus(0);">
			            	<span style="color: red;">停用</span>
			            </a>
			            <a class='btn btn-lg btn-link' id="btn_print" style="color: blue;" onclick="fnPrintFlow();">打印</a>
			            <a class='btn btn-lg btn-link' id="btn_close" style="color: red;" onclick="fnCloseWin();">
			            	<span style="color: red;">关闭</span>
			            </a>
			        </div>
		        </div>
		        
		        <div id="content_div">
		        	<h2>厦门轨道交通集团有限公司业务流程</h2>
		        	<table id="content_table">
		        		<tr>
		        			<td valign="top" style="padding-top: 10px;padding-bottom: 10px;">
					        	<table id="info_table" class="table" style="border: 1px solid #C9C9C9;">
					        		<tr>
					        			<td class="item_title">
					        				流程名称：
					        			</td>
					        			<td colspan="5"><span th:text="${flow.name}"></span></td>
					        		</tr>
					        		<tr>
					        			<td class="item_title">流程编号：</td>
					        			<td class="item_content"><span th:text="${flow.flowNum}"></span></td>
					        			<td class="item_title">控制方式：</td>
					        			<td class="item_content"><span th:text="${flow.controlWay}"></span></td>
					        			<td class="item_title">质量评价：</td>
					        			<td class="item_content"><span th:text="${flow.qualityAssess}"></span></td>
					        		</tr>
					        		<tr>
					        			<td class="item_title">主责部门：</td>
					        			<td class="item_content"><span th:text="${flow.responsibilityDept != null} ? ${flow.responsibilityDept.name} : ${''}"></span></td>
					        			<td class="item_title">维护责任人：</td>
					        			<td class="item_content"><span th:text="${flow.maintainer != null} ? ${flow.maintainer.name} : ${null}"></span></td>
					        			<td class="item_title">流程负责人：</td>
					        			<td class="item_content"><span th:text="${flow.processLeader != null} ? ${flow.processLeader.name} : ${null}"></span></td>
					        		</tr>
					        		<tr>
					        			<td class="item_title">
					        				关联制度：
					        			</td>
					        			<td colspan="5"><span th:text="${flow.associateSystem}"></span></td>
					        		</tr>
					        	</table>
		        			</td>
		        		</tr>
		        	</table>
		        	
		        	<div id="step_head_div" class="box box-default collapsed-box box-solid">
					    <div class="box-header with-border" style="padding: 5px 15px;text-align: left;">
					       	<span style="margin: 8px;font-size: 14px;font-weight: bold;">流程梳理表</span>
					    </div>
					</div>
					<div id="step_body_div" style="text-align: left;">
			            <div id="step_table_div" style="width: 1146px;margin: 5px auto 5px;">
				            <table id="step_table" class="table" >
				            </table>
			            </div>
					</div>
		        </div>
			</div>
		
			<div class="tab-pane fade" id="chart_div">
				<div id="head_div" class="box box-default collapsed-box box-solid">
				    <div class="box-header with-border" style="padding: 3px 8px;text-align: left;">
			            <a class='btn btn-lg btn-link' id="btn_printChart" style="color: blue;" onclick="fnPrintChart();">打印</a>
			            <a class='btn btn-lg btn-link' id="btn_downloadChart" style="color: blue;" th:if="${chartAnnex == null}" >下载</a>
			            <a class='btn btn-lg btn-link' id="btn_downloadChart" style="color: blue;" th:if="${chartAnnex != null}" th:onclick="'fnDownloadChart(\''+${chartAnnex.id}+'\')'">下载</a>
			        </div>
		        </div>
		        
		        <input type="hidden" id="chart_extendName" th:value="${chartAnnex == null} ? ${null} : ${chartAnnex.extendName}" />
		        <div id="chart_content_div">
		        	<iframe id="chartFrame" name="chartFrame" style="width: 100%;height:100%;border:0;"></iframe>
		        </div>
			</div>
		</div>
	
	</div>
	
	<!-- 通用查看图片窗口 -->
	<div class="modal fade" id="common_viewimg_win" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" aria-hidden="true">
		<div class="modal-dialog" style="width:800px;">
			<div class="modal-content">
				<div class="modal-header" style="padding:10px;">
				 	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h4 class="modal-title">图片查看</h4>
				</div>
				<div class="modal-body" style="overflow: hidden; padding: 10px;">
					
				</div>
			</div>
		</div>
	</div>

</body>
<!-- jQuery 2.2.3 -->
<script th:src="@{/static/plugins/jQuery/jquery-2.2.3.min.js}"></script>
<!-- Bootstrap 3.3.7 -->
<script th:src="@{/static/bootstrap/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/common.js}"></script>
<script th:src="@{/static/plugins/bootstrap-validator/js/bootstrapValidator.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js}"></script>
<script th:src="@{/static/plugins/jQuery/jquery.serializejson.min.js}"></script>
<script th:src="@{/static/plugins/datepicker/bootstrap-datepicker.js}"></script>
<script th:src="@{/static/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/extensions/export/bootstrap-table-export.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-contextmenu/bootstrap-contextmenu.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-contextmenu/prettify.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/attention/zDialog/zDrag.js}"></script>
<!-- Slimscroll -->
<script type="text/javascript" th:src="@{/static/plugins/slimScroll/jquery.slimscroll.min.js}"></script>
<script type="text/javascript" th:src="@{/static/dist/js/app.min.js}"></script>
<script type="text/javascript" th:src="@{/static/js/common.js}"></script>
<script type="text/javascript" th:src="@{/static/js/myModalDialogBR.js}"></script>
<!-- bootstrap fileinput js -->
<script th:src="@{/static/plugins/bootstrap-fileinput/js/plugins/sortable.min.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/js/plugins/purify.min.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/js/fileinput.min.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/js/locales/fr.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/js/locales/zh.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/themes/explorer-fa/theme.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/themes/fa/theme.js}" type="text/javascript"></script>
<script type="text/javascript" src="../pageoffice.js" id="po_js_main"></script>
<script th:inline="javascript" type="text/javascript">
/*<![CDATA[*/
	var STATIC = [[@{/static/}]];
	var CTX = [[@{/}]];
	
	$(function () {
		//1.初始化Table
	    var oTable = new TableInit();
	    oTable.Init();
	    
	 	//加载流程图
	    //fnLoadFlowChart();
	    
	    setTimeout(function(){
		    var printType = $('#printType').val();
		    if(printType == 1){
		    	fnPrintFlow(true);
		    }else if(printType == 2){
		    	fnPrintChart(true);
		    }
	    },200);
		
	});
	
	//初始化列表
	var TableInit = function () {
	    var oTableInit = new Object();
	    //初始化Table
	    oTableInit.Init = function () {
	        $('#step_table').bootstrapTable({
	        	url: CTX + 'internal-flow-step/query-page', //请求后台的URL（*）
	            method: 'get',                      //请求方式（*）
	            striped: false,                      //是否显示行间隔色
	            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
	            pagination: true,                   //是否显示分页（*）
	            sortable: false,                     //是否启用排序
	            sortOrder: "asc",                   //排序方式
	            queryParams: oTableInit.queryParams,//传递参数（*）
	            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
	            pageNumber:1,                       //初始化加载第一页，默认第一页
	            pageSize: 10,                       //每页的记录行数（*）
	            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
	            queryParamsType: "a",
	            strictSearch: true,
	            //showColumns: true,                  //是否显示所有的列
	            minimumCountColumns: 2,             //最少允许的列数
	            clickToSelect: true,                //是否启用点击选中行
	            //height:550,	    					//行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
	            uniqueId: "id",                     //每一行的唯一标识，一般为主键列
	            //singleSelect: true,
	            undefinedText: "/",
	            columns: [
				{
				    field: 'number',
				    title:'序号',
				    align : 'center',
				    sortable:true,
				    formatter:function(value,row,index){
				    	var pageSize=$('#step_table').bootstrapTable('getOptions').pageSize;
		                var pageNumber=$('#step_table').bootstrapTable('getOptions').pageNumber;
		                return pageSize * (pageNumber - 1) + index + 1;
				    }
				},{
				    field: 'stepName',
				    title:'流程步骤',
				    align : 'center',
				    sortable:true
				},{
				    field: 'responsibilityDept',
				    title:'负责部门',
				    align : 'center',
				    sortable:true,
				    formatter:function(useunit){
				    	if(useunit != null){
					   		return useunit.name;
				    	}else{
					   		return null;
				    	}
				    }
				},{
				    field: 'responsibilityQuarter',
				    title:'负责岗位',
				    align : 'center',
				    sortable:true
				},{
				    field: 'cooperateDeptNames',
				    title:'配合部门',
				    align : 'center',
				    sortable:true
				},{
				    field: 'requirement',
				    title:'管理要求',
				    align : 'center',
				    sortable:true
				},{
				    field: 'workTable',
				    title:'工作使用表单',
				    align : 'center',
				    sortable:true,
				    formatter:function(workTable){
				    	if(workTable != null){
					   		return '<a class="a_tableName" title="点击查看" href="javascript:fnViewWorkTable(\'' + workTable.id + '\')">'+ workTable.name +'</a>';
				    	}else{
					   		return null;
				    	}
				    }
				},{
				    field: 'consultFileName',
				    title:'工作参考文档',
				    align : 'center',
				    sortable:true,
				    formatter:function(consultFileName,row,index){
				    	if(consultFileName != null){
					   		return '<a class="a_tableName" title="点击下载" href="javascript:openCommonViewImgWin(\'' + row.consultFileId + '\')">'+ consultFileName +'</a>';
				    	}else{
					   		return null;
				    	}
				    }
				},{
				    field: 'supportFileName',
				    title:'工作支持文档',
				    align : 'center',
				    sortable:true,
				    formatter:function(supportFileName,row,index){
				    	if(supportFileName != null){
					   		return '<a class="a_tableName" title="点击下载" href="javascript:openCommonViewImgWin(\'' + row.supportFileId + '\')">'+ supportFileName +'</a>';
				    	}else{
					   		return null;
				    	}
				    }
				},{
				    field: 'annexNames',
				    title:'相关附件',
				    align : 'center',
				    sortable:true,
				    formatter:function(annexNames,row,index){
				    	if(annexNames != null){
					   		return fnFormatAnnexShow(row.annexIds,annexNames);
				    	}else{
					   		return null;
				    	}
				    }
				},],
				formatNoMatches: function () {
		            return '**********暂无数据**********';
		        },
		        formatShowingRows: function (pageFrom, pageTo, totalRows) {
		            return '共 ' + totalRows + ' 条';
		        },
	        });
	    };

	    //得到查询的参数
	    oTableInit.queryParams = function (params) {
	        var temp = {   //这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
	        	flowId: $('#flowId').val(),
	        	pageNum: params.pageNumber,//页码params.offset
                size: params.pageSize//页面大小params.limit
	        };
	        return temp;
	    };
	    return oTableInit;
	};
	
	//加载流程图
	function fnLoadFlowChart(){
		/* $('#chart_content_div').html(''); */
		$('#chart_img').remove();
		var extendName = $('#chart_extendName').val();
		var annexIds = $('#chartId').val();
		if(extendName.toLowerCase()=='jpg' || extendName.toLowerCase()=='jpeg'||
				extendName.toLowerCase()=='bmp' || extendName.toLowerCase()=='gif'||
				extendName.toLowerCase()=='png'){
			$.ajax({
				url:CTX+'annex/query-annex',
				type:'get',
				dataType:'json',
				timeout:10000,
				data: {annexIds:annexIds},
				success:function(json){
					$.each(json,function(i,annex){
						var imgStr = '<img id="chart_img" src="'+STATIC+annex.relativePath+'" alt="'+annex.name+'" onerror="this.src=\''+STATIC+'images/noPicture.jpg\';" style="margin:0 auto;max-width:100%;"/>';
						$('#chart_content_div').append(imgStr);
					});
				},
				error:function(){
				}
			});
		}else if(extendName != null && extendName != '' && extendName != null){
			POBrowser.openWindowModeless(CTX+'/view-file?annexId='+annexIds,'width=1240px;height=800px;');
		}
	}
	
	//变更
	function fnEdit(){
		var dId = $('#flowId').val();
		var r = Math.random().toString().substring(5);
		var url = CTX+'internal-control-flow/detail?opt=change&id='+dId+'&Mathnum='+r;
		var name = "变更流程";
		myShowModalDialogBR(url,name,window.screen.width,window.screen.height,function(v){
 			
 		});
	}
	
	//停用
	function setStatus(flag){
		loading('正在保存设置,请稍候...');
		var ids = $('#flowId').val();
		$.ajax({
            url: CTX + 'internal-control-flow/set-status',
            method: 'post',
            dataType: 'json',
            data: {ids:ids,status:flag},
            success: function (json) {
                loaded();
                alert(json.msg);
                queryInfo();
            },
            error: function () {
                alert('请求超时或系统出错!');
                loaded();
            }
        });
	}
	

	//打印流程信息
	function fnPrintFlow(ifCloseWin){
		var p_html = $("#content_div").html();
		var newWin = window.open('', '_blank', ''); //在当前页打开新的窗口
		var styleStr = '#head_div{ margin: 2px auto 0px; border-color: #F2F2F2; width: 1200px; }'
						+ '#step_head_div{ margin: 25px auto 0px; background-color: #E4E4E4; border: 1px solid #CCCCCC; width: 1170px; }'
						+ '#step_body_div{ margin: 5px auto 15px; border: 1px solid #F2F2F2; width: 1170px; }'
						+ '#tab_div{ margin: 10px auto 0px; width: 1200px; }'
						+ '.box-header>.btn-lg{ padding: 5px 8px; }'
						+ '#content_div{ width: 1200px; border: 1px solid #F2F2F2; margin: 0px auto; }'
						+ 'h2{ text-align: center; margin: 20px 0px 15px; }'
						+ '#content_table{ margin: 10px auto; border: 1px solid #F2F2F2; width: 1170px; }'
						+ '#content_table>td{ padding-bottom: 15px; }'
						+ '#info_table{ width: 1146px; margin: 0px auto; }'
						+ '#info_table>tbody>tr>td{ border: 1px solid #C9C9C9; min-height: 32px; padding: 3px;'
						+ 'font-size: 14px; text-align: center; vertical-align: middle; }'
						+ '.item_title{ text-align: center; vertical-align: middle; background-color: #E4E4E4; width: 191px; }'
						+ '.item_content{ width: 191px; }'
						+ '.table{ border: 1px solid #C9C9C9; border-radius: 0px; border-spacing: 0;}'
						+ '.table>tbody>tr>td{ padding: 3px; vertical-align: middle; border-top: 1px solid #C9C9C9;}'
						+ '#step_table{ width: 1130px; margin: 5px auto 15px; }'
						+ '.a_tableName{ text-decoration: underline; color: #000; }';
		newWin.document.write("<head><style>"+styleStr+"</style></head>"); //向新窗口添加css样式
		newWin.document.write(p_html);
		newWin.print();
		var userAgent = navigator.userAgent;
		if (userAgent.indexOf("Chrome") != -1) {
			newWin.close();
		} else {
			if (tata = newWin.document.execCommand("print")) {
				newWin.close();
			}
		}
		if(ifCloseWin){
			fnCloseWin();
		}
	}
	
	//打印流程图
	function fnPrintChart(ifCloseWin){
		var p_html = $("#chart_content_div").html();
		var newWin = window.open('', '_blank', ''); //在当前页打开新的窗口
		var styleStr = '#chart_content_div{ width: 1198px; }';
		newWin.document.write("<head><style>"+styleStr+"</style></head>"); //向新窗口添加css样式
		newWin.document.write(p_html);
		newWin.print();
		var userAgent = navigator.userAgent;
		if (userAgent.indexOf("Chrome") != -1) {
			newWin.close();
		} else {
			if (tata = newWin.document.execCommand("print")) {
				newWin.close();
			}
		}
		if(ifCloseWin){
			fnCloseWin();
		}
	}
	
	//下载流程图
	function fnDownloadChart(annexIds){
		if(STATIC.indexOf(";") > -1){
			STATIC = STATIC.substring(0,STATIC.indexOf(";"));
		}
		console.log("STATIC:"+ STATIC);
		if(annexIds==null||annexIds==''){
			alert('附件不存在');
			return;
		}
		loading('加载中...');
		
		$.ajax({
			url:CTX+'annex/query-annex',
			type:'get',
			dataType:'json',
			timeout:10000,
			data: {annexIds:annexIds},
			success:function(json){
				loaded();
				$.each(json,function(i,annex){
					var newWin = window.open('', '_blank', '');
					newWin.location.href = STATIC+annex.relativePath;
				});
			},
			error:function(){
				alert('请求超时或系统错误');
				loaded();
			}
		});
	}
	
	//关闭
	function fnCloseWin(){
		myReturnValueBR(1);
		window.close();
	}
	
	//查看工作用表
	function fnViewWorkTable(dId){
		var r = Math.random().toString().substring(5);
		var url = CTX+'work-table-info/view?id='+dId+'&Mathnum='+r;
		var name = "工作用表详情";
		window.open(url,'_blank','width='+window.screen.width+',height='+window.screen.height);
	}
	
	//格式化附件显示
	function fnFormatAnnexShow(annexIds,annexNames){
		var idArr = annexIds.split(',');
		var nameArr = annexNames.split(',');
		var resultStr = "";
		for(var i = 0; i < idArr.length; i++){
			var aStr = '<a class="a_tableName" title="点击下载" href="javascript:openCommonViewImgWin(\'' + idArr[i] + '\')">'+ nameArr[i] +'</a>';
			if(i==0){
				resultStr = aStr;
			}else{
				resultStr += "<br>" + aStr;
			}
		}
		return resultStr;
	}
	
	//初始化按钮
	var ButtonInit = function () {
	    var oInit = new Object();
	    var postdata = {};

	    oInit.Init = function () {
	        //初始化页面上面的按钮事件
	    };

	    return oInit;
	};
		
	/*]]>*/
</script>
<script type="text/javascript" th:src="@{/static/modules/internal/internal-file-upload.js}"></script>	
</html>
