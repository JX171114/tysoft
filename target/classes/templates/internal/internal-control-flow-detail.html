<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--
* @Copyright(c): 厦门路桥信息股份有限公司  版权所有
* @author :XMRBI
* @Description:内控管理流程详情
* @createDate:2018-11-09
-->
<head>
	<meta charset="UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
	<title th:text="${#strings.equals(opt, 'new')} ? ${'新增流程'} : ${'变更流程'}"></title>
	<link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/css/common.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/select2/select2.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/bootstrap-validator/css/bootstrapValidator.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/skins/_all-skins.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
    <link rel="stylesheet" th:href="@{/static/plugins/jvectormap/jquery-jvectormap-1.2.2.css}"/>
    <!-- Theme style -->
	<link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/dist/css/skins/_all-skins.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/css/common.css}"/>
	<!-- Bootstrap 3.3.7 -->
	<link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.css}"/>
	<link th:href="@{/static/plugins/bootstrap-fileinput/css/fileinput.css}" media="all" rel="stylesheet" type="text/css"/>
	<link th:href="@{/static/plugins/bootstrap-fileinput/themes/explorer-fa/theme.css}" media="all" rel="stylesheet" type="text/css"/>
	<!-- bootstrap datepicker -->
  	<link rel="stylesheet" th:href="@{/static/plugins/datepicker/datepicker3.css}"/>
	<style type="text/css">
	.panel {
	  margin-bottom: 0px;
	}
	.form-group {
	  margin-bottom: 2px;
	}
	
	</style>
	<style type="text/css">
        html, body {
            overflow-x: hidden;
        }
        body {
            padding-top: 5px;
        }
        .box.box-solid.box-default>.box-header {
        	background-color: #F2F2F2;
        	padding: 3px 10px;
        }
        .btn-link:HOVER {
			text-decoration: none;
		}
		.modal-header{
			background-color:#F4F6F8;
			border-top-left-radius: 5px;
			border-top-right-radius: 5px;
		}
		.container-fluid{
			padding-right: 10px;
			padding-left: 10px;
		}
		#head_div{
			margin: 2px auto 0px;
			border-color: #F2F2F2;
			width: 1200px; 
		}
		
		#step_head_div{
			margin: 45px auto 0px;
			background-color: #E4E4E4;
			border: 1px solid #CCCCCC;
			width: 1170px;
		}
		#step_body_div{
			margin: 0px auto 15px;
			border: 1px solid #CCCCCC;
			width: 1170px;
		}
		#tab_div{
			margin: 10px auto 0px;
			width: 1200px;
		}
		.box-header>.btn-lg{
			padding: 5px 8px;
		}
		#content_div,#chart_div{
			width: 1200px;
			border: 1px solid #F2F2F2;
			margin: 0px auto;
		}
		#chart_div{
			min-height: 500px;
		}
		h2{
			text-align: center;
			margin: 20px 0px 15px;
		}
		.input-group>.input-group-addon{
			/* border-radius: 4px; */
			border-top-left-radius: 4px;
			border-bottom-left-radius: 4px;
			background-color: #F2F2F2;
		}
		.form-control{
			height: 36px;
		}
		.input-div{
			padding: 5px 20px;
		}
		#content_table{
			margin: 10px auto;
			border: 1px silver solid;
			width: 1170px;
		}
		#content_table>td{
			padding-bottom: 15px;
		}
		.itemName{
			/* width: 114px; */
			height: 36px;
			background-color: #F2F2F2;
			padding: 6px 0px;
			text-align: center;
			border-radius: 4px;
			border: 1px solid #d2d6de;
		}
		.select_a{
			padding: 5px 8px;
		}
		.table>tbody>tr>td{
			padding: 3px;
			vertical-align: middle;
		}
		#edit_sysuser_orgtree ul li{
            text-align: left;
        }
		#edit_useunit_orgtree ul li{
            text-align: left;
        }
        .btn-file,.btn-files{
        	padding: 8px 0px;
        	margin-right: 10px;
        	font-size: 14px;
        }
        #myTab li a{
        	font-size: 16px;
        	padding: 8px 15px;
        }
        .active>li>a{
        	color: blue;
        }
        #step_table{
        	margin: 5px auto 15px;
        }
        .fixed-table-container{
			border: none;
			border-radius: 0px;
		}
		.table{
			border: 1px solid #C9C9C9;
			border-radius: 0px;
		}
		.table>thead>tr>th{
			background-color: #E4E4E4;
			border-left: none;
			border-right: none;
		}
		.table>tbody>tr>td{
			padding: 3px;
			vertical-align: middle;
			border-left: none;
			border-right: none;
		}
		#chart_content_div{
			width: 1198px;
		}
		.a_tableName{
			text-decoration: underline;
			color: #000;
		}
          
    </style>
</head>
<body style="text-align: center;">
	<input type="hidden" id="temp_userId" />
	<input type="hidden" id="temp_userName" />
	<input type="hidden" id="temp_useunitId" />
	<input type="hidden" id="temp_useunitName" />

	<input type="hidden" id="now_user_lesseeId" name="lesseeId" th:value="${now_user_lesseeId}"/>
    <input type="hidden" id="now_user_useunitId" name="useunitId" th:value="${now_user_useunitId}"/>
    <input type="hidden" id="now_user_id" name="userId" th:value="${now_user_id}"/>
    <!--用户表格过滤条件 -->
    <form id="sysuserOrgFormSearch" class="form-horizontal">
    	<input type="hidden" name="sysuserId" th:value="${now_user_id}"/>
        <input type="hidden" id="edit_sysuser_useunit" name="useunitId"/>
    </form>
    
	<div class="container-fluid" style="width:100%; height: 100%" >
		<div id="tab_div">
			<ul id="myTab" class="nav nav-tabs"><!--  style="background-color: #EDF1F5;" -->
				<li class="active">
					<a href="#detail_div" data-toggle="tab">基本信息</a>
				</li>
				<li>
					<a href="#chart_div" data-toggle="tab" onclick="fnLoadFlowChart();">流程图</a>
				</li>
			</ul>
		</div>
		
		<div id="myTabContent" class="tab-content">
			<div class="tab-pane fade in active" id="detail_div">
				<div id="head_div" class="box box-default collapsed-box box-solid">
				    <div class="box-header with-border" style="padding: 3px 8px;text-align: left;">
			        	<a class='btn btn-lg btn-link' id="btn_saveNew" style="color: blue;" onclick="fnSave();">保存</a>
			            <a class='btn btn-lg btn-link' id="btn_print" style="color: blue;" onclick="fnPrint(1);">打印</a>
			            <a class='btn btn-lg btn-link' id="btn_close" style="color: red;" onclick="fnCloseWin();">
			            	<span style="color: red;" th:text="${#strings.equals(opt, 'new')} ? ${'关闭'} : ${'返回'}"></span>
			            </a>
			        </div>
		        </div>
		        
		        <div id="content_div">
		        	<h2 th:if="${#strings.equals(opt, 'new')}">厦门轨道交通集团有限公司业务活动事项内控单</h2>
					<h2 th:if="${!#strings.equals(opt, 'new')}">厦门轨道交通集团有限公司业务活动事项内控变更单</h2>
		        	<table id="content_table">
		        		<tr>
		        			<td valign="top" style="padding-top: 10px;padding-bottom: 10px;">
					        	<form id="flow_form" class="form-horizontal">
					        		<input id="opt" name="opt" type="hidden" th:value="${opt}" />
					        		<input id="flowId" name="flowId" type="hidden" th:value="${#strings.isEmpty(flow.id)} ? ${null} : ${flow.id}" />
					        		<input name="version" th:value="${flow.version}" type="hidden" />
					        		<input name="versionNo" th:value="${flow.versionNo}" type="hidden" />
					        		<input name="status" th:value="${flow.status}" type="hidden" />
					        		<input name="chartId" th:value="${chartAnnex != null} ? ${chartAnnex.id} : ${null}" type="hidden" />
					        		<input name="directory.id" th:value="${flow.directory != null} ? ${flow.directory.id} : ${''}" type="hidden" />
					        		<div class="col-md-12 input-div">
				            			<div class="input-group">
										  	<span class="input-group-addon">流程名称<span style="color: red;">*</span></span>
										  	<input type="text" class="form-control" name="name" th:value="${flow.name}"/>
										</div>
				            		</div>
				            		
				            		<div class="col-md-12 input-div">
				            			<div class="col-md-6" style="padding-left: 0px;">
				            				<div class="input-group">
											  	<span class="input-group-addon">流程编号<span style="color: red;">*</span></span>
											  	<input type="text" class="form-control" name="flowNum" th:value="${flow.flowNum}"/>
											</div>
				            			</div>
				            			<div class="col-md-6" style="padding-right: 0px;">
				            				<div class="input-group">
											  	<span class="input-group-addon">控制方式</span>
											  	<input type="text" class="form-control" name="controlWay" th:value="${flow.controlWay}"/>
											</div>
				            			</div>
				            		</div>
				            		
				            		<div class="col-md-12 input-div">
				            			<div class="col-md-1 itemName" style="border-bottom-right-radius: 0px;border-top-right-radius: 0px;">
					            			质量评价
				            			</div>
					            		<div class="col-md-5" style="padding-left: 0px;border-bottom-left-radius: 0px;border-top-left-radius: 0px;">
					            			<input id="temp_qualityAssess" th:value="${flow.qualityAssess}" type="hidden" />
					            			<select class="form-control" name="qualityAssess" id="qualityAssess" style="padding-left: 3px;padding-right: 3px;
					            				border-bottom-left-radius: 0px;border-top-left-radius: 0px;">
						                   	 	<option value="">==请选择==</option>
						                   	 	<option value="☆">☆</option>
						                   	 	<option value="☆☆">☆☆</option>
						                   	 	<option value="☆☆☆">☆☆☆</option>
						                   	 	<option value="☆☆☆☆">☆☆☆☆</option>
						                   	 	<option value="☆☆☆☆☆">☆☆☆☆☆</option>
						                   	</select>
					            		</div>
				            			<div class="col-md-5">
				            				<div class="input-group">
											  	<span class="input-group-addon">主责部门<span style="color: red;">*</span></span>
											  	<input type="hidden" name="responsibilityDept.id" th:value="${flow.responsibilityDept != null} ? ${flow.responsibilityDept.id} : ${null}" />
											  	<input type="text" disabled="disabled" class="form-control" id="responsibilityDeptName" th:value="${flow.responsibilityDept != null} ? ${flow.responsibilityDept.name} : ${null}"/>
											</div>
				            			</div>
				            			<div class="col-md-1" style="height: 36px;padding: 0px;">
				            				<a class="btn btn-lg btn-link select_a" title="点击选择" onclick="fnSelectUseunit();"><span class="glyphicon glyphicon-edit"></span></a>
				            				<a class="btn btn-lg btn-link select_a" title="点击清空" onclick="fnCleanResponsibilityDept();"><span class="glyphicon glyphicon-remove"></span></a>
				            			</div>
				            		</div>
				            		
				            		<div class="col-md-12 input-div">
				            			<div class="col-md-5" style="padding-left: 0px;">
				            				<div class="input-group">
											  	<span class="input-group-addon">维护责任人<span style="color: red;">*</span></span>
											  	<input type="hidden" name="maintainer.id" th:value="${flow.maintainer != null} ? ${flow.maintainer.id} : ${null}" />
											  	<input type="text" disabled="disabled" class="form-control" id="maintainerName" th:value="${flow.maintainer != null} ? ${flow.maintainer.name} : ${null}"/>
											</div>
				            			</div>
				            			<div class="col-md-1" style="height: 36px;padding: 0px;">
				            				<a class="btn btn-lg btn-link select_a" title="点击选择" onclick="fnSelectUser(1);"><span class="glyphicon glyphicon-edit"></span></a>
				            				<a class="btn btn-lg btn-link select_a" title="点击清空" onclick="fnCleanMaintainer();"><span class="glyphicon glyphicon-remove"></span></a>
				            			</div>
				            			<div class="col-md-5" >
				            				<div class="input-group">
											  	<span class="input-group-addon">流程负责人<span style="color: red;">*</span></span>
											  	<input type="hidden" name="processLeader.id" th:value="${flow.processLeader != null} ? ${flow.processLeader.id} : ${null}" />
											  	<input type="text" disabled="disabled" class="form-control" id="processLeaderName" th:value="${flow.processLeader != null} ? ${flow.processLeader.name} : ${null}"/>
											</div>
				            			</div>
				            			<div class="col-md-1" style="height: 36px;padding: 0px;">
				            				<a class="btn btn-lg btn-link select_a" title="点击选择" onclick="fnSelectUser(2);"><span class="glyphicon glyphicon-edit"></span></a>
				            				<a class="btn btn-lg btn-link select_a" title="点击清空" onclick="fnCleanProcessLeader();"><span class="glyphicon glyphicon-remove"></span></a>
				            			</div>
				            		</div>
				            		
					        		<div class="col-md-12 input-div">
				            			<div class="input-group">
										  	<span class="input-group-addon">关联制度<span style="color: red;">*</span></span>
										  	<input type="text" class="form-control" name="associateSystem" th:value="${flow.associateSystem}"/>
										</div>
				            		</div>
					        	</form>
		        			</td>
		        		</tr>
		        	</table>
		        	
		        	<div id="step_head_div" class="box box-default collapsed-box box-solid">
					    <div class="box-header with-border" style="padding: 5px 15px;text-align: left;">
					       	<span style="margin: 8px;font-size: 14px;font-weight: bold;">流程梳理表</span>
					    </div>
					</div>
					<div id="step_body_div" style="text-align: left;">
						<button id="btn_addStep" type="button" class="btn btn-sm btn-primary" style="margin: 8px 5px 8px 20px;background-color: blue;border-color: blue;"
							 onclick="fnAddFlowStep();">新增
			            </button>
						<button id="btn_editStep" type="button" class="btn btn-sm btn-primary" style="margin: 8px 10px;background-color: blue;border-color: blue;"
							 onclick="fnEditFlowStep();">编辑
			            </button>
						<button id="btn_deleteStep" type="button" class="btn btn-sm" style="margin: 8px 5px;background-color: red;border-color: red;color: #fff;"
							 onclick="fnDeleteFlowStep();">批量删除
			            </button>
			            
			            <div id="step_table_div" style="width: 1130px;margin: 5px auto 15px;">
				            <table id="step_table" class="table">
				            </table>
			            </div>
					</div>
		        </div>
			</div>
		
			<div class="tab-pane fade" id="chart_div">
				<div id="head_div" class="box box-default collapsed-box box-solid">
				    <div class="box-header with-border" style="padding: 3px 8px;text-align: left;">
			        	<a class='btn btn-lg btn-link' id="btn_upload" style="color: blue;" th:onclick="'fnUploadAnnex('+${anndexFolder.id}+',\''+${anndexFolder.folderName}+'\')'">上传</a>
			            <a class='btn btn-lg btn-link' id="btn_printChart" style="color: blue;" onclick="fnPrint(2);">打印</a>
			            <a class='btn btn-lg btn-link' id="btn_deleteChart" style="color: red;" onclick="fnDeleteChart();">删除</a>
			        </div>
		        </div>
		        
		        <input type="hidden" id="chart_extendName" th:value="${chartAnnex == null} ? ${null} : ${chartAnnex.extendName}" />
		        <div id="chart_content_div">
		        	<iframe id="chartFrame" name="chartFrame" style="width: 100%;height:100%;border:0;"></iframe>
		        </div>
			</div>
		</div>
	
	</div>
	
	<!-- 选择部门 -->
	<div class="modal fade" id="win_selectUseunit" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static"
	     aria-hidden="true">
	    <div class="modal-dialog" style="width:800px;">
	        <div class="modal-content">
	            <div class="modal-header" style="text-align: center;background-color: #357ca5;">
	                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
	                <h4 class="modal-title" style="color:white;">选择部门</h4>
	            </div>
	            <div class="modal-body" style="padding: 10px;">
	                <div class="box box-default box-solid" style="margin-bottom:5px; min-height: 40px">
	                	<div class="box-body" id="useunit_name"></div>
	                </div>
	                <div class="box box-default box-solid" style="margin-bottom:5px;">
	                    <div class="box-body">
	                    	<div class="col-sm-12" id="useunitTree_div" style="overflow: auto;">
	                        	<div id="edit_useunit_orgtree"></div>
	                        </div>
	                   	</div>
	                </div>
	            </div>
	            <div class="modal-footer" style="text-align: center;">
	                <button type="button" onclick="fnSetUseunit();" class="btn btn-primary">确定</button>
	                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
	            </div>
	        </div>
	    </div>
	</div>

	<!-- 选择用户  -->
	<div class="modal fade" id="win_selectUser" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static"
	     aria-hidden="true">
	    <div class="modal-dialog" style="width:1000px;">
	        <div class="modal-content">
	            <div class="modal-header" style="text-align: center;background-color: #357ca5;">
	                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
	                <h4 class="modal-title" style="color:white;">选择用户</h4>
	            </div>
	            <div class="modal-body" style="padding: 10px;">
	                <form class="form-horizontal" id="selectUser_form">
	                    <div class="box box-default box-solid" style="margin-bottom:5px; min-height: 40px">
	                        <div class="box-body" id="sysuser_user_name">
	                        </div>
	                    </div>
	                    <div class="box box-default box-solid" style="margin-bottom:5px;">
	                        <div class="box-body">
	                            <div class="col-sm-6" id="orgtree_div" style="overflow: auto;">
	                                <div id="edit_sysuser_orgtree"></div>
	                            </div>
	                            <div class="col-sm-6">
	                                <table id="edit_sysuser_orgusertable"></table>
	                            </div>
	                        </div>
	                    </div>
	                </form>
	            </div>
	            <div class="modal-footer" style="text-align: center;">
	                <button type="button" onclick="fnSetUserId();" class="btn btn-primary">确定</button>
	                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
	            </div>
	        </div>
	    </div>
	</div>
	
	<!-- 上传附件窗口 -->
	<div class="modal fade modal-info" id="upload_annex_win" role="dialog" data-backdrop="false" aria-hidden="true">
		<div class="modal-dialog" style="width:900px;">
	      	<div class="modal-content" style="background-color:rgba(255, 255, 255, 0);">
		        <div class="modal-header" style="padding:5px;">
		          	<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-top:0;">
		            	<span aria-hidden="true">&times;</span>
		            </button>
		            <button type="button" class="close" style="margin-right:5px;margin-top: -1px;" onclick="fnMaxModalWin2(this)">
		            	<i class="fa fa-square-o" style="font-size:16px;"></i>
		            </button>
		          	<h4 class="modal-title" style="text-align:center;"></h4>
		        </div>
		        <div class="modal-body" style="height: 450px;padding:0px;background-color: rgba(3, 51, 101, 0.9) !important;">
		          	<iframe id="annexFrame" name="annexFrame" style="width: 100%;height:100%;border:0;"></iframe>
		        </div>
	      	</div>
		</div>
	</div>
	
	<!-- 通用查看图片窗口 -->
	<div class="modal fade" id="common_viewimg_win" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" aria-hidden="true">
		<div class="modal-dialog" style="width:800px;">
			<div class="modal-content">
				<div class="modal-header" style="padding:10px;">
				 	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h4 class="modal-title">图片查看</h4>
				</div>
				<div class="modal-body" style="overflow: hidden; padding: 10px;">
					
				</div>
			</div>
		</div>
	</div>

</body>
<!-- jQuery 2.2.3 -->
<script th:src="@{/static/plugins/jQuery/jquery-2.2.3.min.js}"></script>
<!-- Bootstrap 3.3.7 -->
<script th:src="@{/static/bootstrap/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/common.js}"></script>
<script th:src="@{/static/plugins/bootstrap-validator/js/bootstrapValidator.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js}"></script>
<script th:src="@{/static/plugins/jQuery/jquery.serializejson.min.js}"></script>
<script th:src="@{/static/plugins/datepicker/bootstrap-datepicker.js}"></script>
<script th:src="@{/static/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-table/dist/extensions/export/bootstrap-table-export.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-contextmenu/bootstrap-contextmenu.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-contextmenu/prettify.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/attention/zDialog/zDrag.js}"></script>
<!-- Slimscroll -->
<script type="text/javascript" th:src="@{/static/plugins/slimScroll/jquery.slimscroll.min.js}"></script>
<script type="text/javascript" th:src="@{/static/dist/js/app.min.js}"></script>
<script type="text/javascript" th:src="@{/static/js/common.js}"></script>
<script type="text/javascript" th:src="@{/static/js/myModalDialogBR.js}"></script>
<!-- bootstrap fileinput js -->
<script th:src="@{/static/plugins/bootstrap-fileinput/js/plugins/sortable.min.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/js/plugins/purify.min.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/js/fileinput.min.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/js/locales/fr.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/js/locales/zh.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/themes/explorer-fa/theme.js}" type="text/javascript"></script>
<script th:src="@{/static/plugins/bootstrap-fileinput/themes/fa/theme.js}" type="text/javascript"></script>
<script type="text/javascript" src="../pageoffice.js" id="po_js_main"></script>
<script th:inline="javascript" type="text/javascript">
/*<![CDATA[*/
	var STATIC = [[@{/static/}]];
	var CTX = [[@{/}]];
	
	var curType = 1;//标记维护责任人or流程负责人
	var saveSuccess = true;
	
	$(function () {
		$("select[name='qualityAssess']").val($('#temp_qualityAssess').val());
		
		//1.初始化Table
	    var oTable = new TableInit();
	    oTable.Init();
	    
		//2.初始化Button的点击事件
	    var oButtonInit = new ButtonInit();
	    oButtonInit.Init();
	    
	    //加载流程图
	    //fnLoadFlowChart();
	    
		//初始化时间控件
	    $('.datepicker').datepicker({
	    	format:'yyyy-mm-dd',
	    	language:'zh-CN',
	      	autoclose: true,
	      	startView: 'months', //开始视图层，为月视图层
	    }).on('hide', function() {
	        $('#flow_form').data('bootstrapValidator').updateStatus('application_time', 'NOT_VALIDATED',null).validateField('application_time');
	    });
		
		$('#orgtree_div').height($(window).height()-310);
		$('#useunitTree_div').height($(window).height()-310);
		
		//初始化选择用户模态窗口关闭事件
	    $('#win_selectUser').on('hidden.bs.modal', function (e) {
	    	//从展示框中移除
    	    $('#selected_edit_sysuser').remove();
	    	$('#edit_sysuser_orgusertable').bootstrapTable('uncheckAll');
	    	
	    	$('#temp_userId').val('');
	    	$('#temp_userName').val('');
	    	
	    	$('#flow_form').data('bootstrapValidator').updateStatus('maintainer.id', 'NOT_VALIDATED',null).validateField('maintainer.id');
	    	$('#flow_form').data('bootstrapValidator').updateStatus('processLeader.id', 'NOT_VALIDATED',null).validateField('processLeader.id');
	    });

		//初始化选择部门模态窗口关闭事件
	    $('#win_selectUseunit').on('hidden.bs.modal', function (e) {
	    	//从展示框中移除
    	    $('#selected_edit_useunit').remove();
	    	
    	    $('#temp_useunitId').val('');
	    	$('#temp_useunitName').val('');
	    	$('#flow_form').data('bootstrapValidator').updateStatus('responsibilityDept.id', 'NOT_VALIDATED',null).validateField('responsibilityDept.id');
	    });
		
		//表单校验
	    $('#flow_form').bootstrapValidator({
			message: '此处输入有误',
	        excluded: [':disabled'],
	        feedbackIcons: {
	            valid: 'glyphicon glyphicon-ok',
	            invalid: 'glyphicon glyphicon-remove',
	            validating: 'glyphicon glyphicon-refresh'
	        },
	        fields:{
	        	'name':{
	        		message: '流程名称输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '流程名称不可为空'
	                    }
	                }
	        	},
	        	'flowNum':{
	        		message: '流程编号输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '流程编号不可为空'
	                    }
	                }
	        	},
	        	'responsibilityDept.id':{
	        		message: '主责部门输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '主责部门不可为空'
	                    }
	                }
	        	},
	        	'maintainer.id':{
	        		message: '维护责任人输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '维护责任人不可为空'
	                    }
	                }
	        	},
	        	'processLeader.id':{
	        		message: '流程负责人输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '流程负责人不可为空'
	                    }
	                }
	        	},
	        	'associateSystem':{
	        		message: '关联制度输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '关联制度不可为空'
	                    }
	                }
	        	}
	        }
		});
		
	});
	
	//初始化列表
	var TableInit = function () {
	    var oTableInit = new Object();
	    //初始化Table
	    oTableInit.Init = function () {
	        $('#step_table').bootstrapTable({
	        	url: CTX + 'internal-flow-step/query-page', //请求后台的URL（*）
	            method: 'get',                      //请求方式（*）
	            striped: false,                      //是否显示行间隔色
	            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
	            pagination: true,                   //是否显示分页（*）
	            sortable: false,                     //是否启用排序
	            sortOrder: "asc",                   //排序方式
	            queryParams: oTableInit.queryParams,//传递参数（*）
	            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
	            pageNumber:1,                       //初始化加载第一页，默认第一页
	            pageSize: 10,                       //每页的记录行数（*）
	            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
	            queryParamsType: "a",
	            strictSearch: true,
	            //showColumns: true,                  //是否显示所有的列
	            minimumCountColumns: 2,             //最少允许的列数
	            clickToSelect: true,                //是否启用点击选中行
	            //height:550,	    					//行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
	            uniqueId: "id",                     //每一行的唯一标识，一般为主键列
	            //singleSelect: true,
	            undefinedText: "/",
	            columns: [
				{
	            	checkbox:true
		        },{
				    field: 'number',
				    title:'序号',
				    align : 'center',
				    sortable:true,
				    formatter:function(value,row,index){
				    	var pageSize=$('#step_table').bootstrapTable('getOptions').pageSize;
		                var pageNumber=$('#step_table').bootstrapTable('getOptions').pageNumber;
		                return pageSize * (pageNumber - 1) + index + 1;
				    }
				},{
				    field: 'stepName',
				    title:'流程步骤',
				    align : 'center',
				    sortable:true
				},{
				    field: 'responsibilityDept',
				    title:'负责部门',
				    align : 'center',
				    sortable:true,
				    formatter:function(useunit){
				    	if(useunit != null){
					   		return useunit.name;
				    	}else{
					   		return null;
				    	}
				    }
				},{
				    field: 'responsibilityQuarter',
				    title:'负责岗位',
				    align : 'center',
				    sortable:true
				},{
				    field: 'cooperateDeptNames',
				    title:'配合部门',
				    align : 'center',
				    sortable:true
				},{
				    field: 'requirement',
				    title:'管理要求',
				    align : 'center',
				    sortable:true
				},{
				    field: 'workTable',
				    title:'工作使用表单',
				    align : 'center',
				    sortable:true,
				    formatter:function(workTable){
				    	if(workTable != null){
					   		return '<a class="a_tableName" title="点击查看" href="javascript:fnViewWorkTable(\'' + workTable.id + '\')">'+ workTable.name +'</a>';
				    	}else{
					   		return null;
				    	}
				    }
				},{
				    field: 'consultFileName',
				    title:'工作参考文档',
				    align : 'center',
				    sortable:true,
				    formatter:function(consultFileName,row,index){
				    	if(consultFileName != null){
					   		return '<a class="a_tableName" title="点击下载" href="javascript:openCommonViewImgWin(\'' + row.consultFileId + '\')">'+ consultFileName +'</a>';
				    	}else{
					   		return null;
				    	}
				    }
				},{
				    field: 'supportFileName',
				    title:'工作支持文档',
				    align : 'center',
				    sortable:true,
				    formatter:function(supportFileName,row,index){
				    	if(supportFileName != null){
					   		return '<a class="a_tableName" title="点击下载" href="javascript:openCommonViewImgWin(\'' + row.supportFileId + '\')">'+ supportFileName +'</a>';
				    	}else{
					   		return null;
				    	}
				    }
				},{
				    field: 'annexNames',
				    title:'相关附件',
				    align : 'center',
				    sortable:true,
				    formatter:function(annexNames,row,index){
				    	if(annexNames != null){
					   		return fnFormatAnnexShow(row.annexIds,annexNames);
				    	}else{
					   		return null;
				    	}
				    }
				},],
				formatNoMatches: function () {
		            return '**********暂无数据**********';
		        },
		        formatShowingRows: function (pageFrom, pageTo, totalRows) {
		            return '共 ' + totalRows + ' 条';
		        },
	        });
	    };

	    //得到查询的参数
	    oTableInit.queryParams = function (params) {
	        var temp = {   //这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
	        	flowId: $('#flowId').val(),
	        	pageNum: params.pageNumber,//页码params.offset
                size: params.pageSize//页面大小params.limit
	        };
	        return temp;
	    };
	    return oTableInit;
	};
	
	//加载流程图
	function fnLoadFlowChart(){
		/* $('#chart_content_div').html(''); */
		$('#chart_img').remove();
		var extendName = $('#chart_extendName').val();
		var annexIds = $('#flow_form').find("input[name='chartId']").val();
		if(extendName.toLowerCase()=='jpg' || extendName.toLowerCase()=='jpeg'||
				extendName.toLowerCase()=='bmp' || extendName.toLowerCase()=='gif'||
				extendName.toLowerCase()=='png'){
			$.ajax({
				url:CTX+'annex/query-annex',
				type:'get',
				dataType:'json',
				timeout:10000,
				data: {annexIds:annexIds},
				success:function(json){
					$.each(json,function(i,annex){
						var imgStr = '<img id="chart_img" src="'+STATIC+annex.relativePath+'" alt="'+annex.name+'" onerror="this.src=\''+STATIC+'images/noPicture.jpg\';" style="margin:0 auto;max-width:100%;"/>';
						$('#chart_content_div').append(imgStr);
					});
				},
				error:function(){
				}
			});
		}else if(extendName != null && extendName != '' && extendName != null){
			/* var url = CTX+'/view-file';
			$('#chart_content_div iframe').attr('src',url); */
			POBrowser.openWindowModeless(CTX+'/view-file?annexId='+annexIds,'width=1240px;height=800px;');
		}
	}
	
	//保存
	function fnSave(){
		//$('#flow_form').find("input[name='chartId']").val();
		var result = $('#flow_form').data('bootstrapValidator');
		result.validate();
		if(result.isValid()){
			loading('正在保存,请稍候...');
			setTimeout(function(){
				$.ajax({  
					url: CTX+'internal-control-flow/save',
		            type: 'POST',  
		            data:$('#flow_form').serialize(),// 序列化表单值  
		            dataType: 'json',//服务端接收的数据类型
		            async: false,
		            success:function(json) {  
						if(json.success){
							saveSuccess = true;
							alert(json.msg);
							$('#flowId').val(json.internalControlFlow.id);
						}else{
							saveSuccess = false;
							alert(json.msg);
						}
						loaded();
		            },  
		            error:function(json) {
		            	saveSuccess = false;
		            	alert('保存流程出错!');
						loaded();
		            }  
		        });
				$('#flow_form').bootstrapValidator('resetForm');//重置表单校验
			},200);
		}
	}

	//打印
	function fnPrint(printType){//1:打印信息;2:流程图
		if(printType == 1){
			var dId = $('#flowId').val();
			var r = Math.random().toString().substring(5);
			var url = CTX+'internal-control-flow/view?opt=&id='+dId+'&printType='+printType+'&Mathnum='+r;
			var name = "打印流程详情";
			myShowModalDialogBR(url,name,window.screen.width,window.screen.height,function(v){
	
			});
		}else{
			var p_html = $("#chart_content_div").html();
			var newWin = window.open('', '_blank', ''); //在当前页打开新的窗口
			var styleStr = '#chart_content_div{ width: 1198px; }';
			newWin.document.write("<head><style>"+styleStr+"</style></head>"); //向新窗口添加css样式
			newWin.document.write(p_html);
			newWin.print();
			var userAgent = navigator.userAgent;
			if (userAgent.indexOf("Chrome") != -1) {
				newWin.close();
			} else {
				if (tata = newWin.document.execCommand("print")) {
					newWin.close();
				}
			}
		}
	}
	
	//删除流程图
	function fnDeleteChart(){
		var chartId = $('#flow_form').find("input[name='chartId']").val();
		if(chartId != null && chartId != ''){
			loading('正在删除，请稍候...');
			$.ajax({
				url: CTX+"annex/delete-annex",
				type: "POST",
				data: {key: chartId},
				dataType: 'json',
				success: function(data){
					if(data.success){
						alert('删除成功！');
						loaded();
						$('#chart_content_div').html('');
						$('#chart_extendName').val('');
					}
					loaded();
	            },  
	            error:function(json) {
	            	alert('删除失败!');
					loaded();
	            }
			});
		}
	}
	
	//关闭
	function fnCloseWin(){
		myReturnValueBR(1);
		window.close();
	}
	
	//清空主责部门
	function fnCleanResponsibilityDept(){
		$('#flow_form').find("input[name='responsibilityDept.id']").val('');
		$('#responsibilityDeptName').val('');
	}
	
	//清空维护责任人
	function fnCleanMaintainer(){
		$('#flow_form').find("input[name='maintainer.id']").val('');
		$('#maintainerName').val('');
	}
	
	//清空流程负责人
	function fnCleanProcessLeader(){
		$('#flow_form').find("input[name='processLeader.id']").val('');
		$('#processLeaderName').val('');
	}
	
	//清空所有
	function fnCleanAllVal(){
		fnCleanResponsibilityDept();
		fnCleanMaintainer();
		fnCleanProcessLeader();
		
		$('.btn-files').remove();
		$('#flow_form').find("input[name='id']").val('');
		$('#flow_form').find("input[name='chartId']").val('');
		$('#flow_form').find("input[name='name']").val('');
		$('#flow_form').find("input[name='flowNum']").val('');
		$('#flow_form').find("input[name='controlWay']").val('');
		$('#flow_form').find("input[name='qualityAssess']").val('');
		$('#flow_form').find("input[name='associateSystem']").val('');
		//移除流程图
		$('#chart_content_div').html('');
	}
	
	//选择主责部门
	function fnSelectUseunit(){
		loading('正在加载数据,请稍候...');
		var r = Math.random().toString().substring(5);
        $.ajax({
            url: CTX + 'organizationManage/query-all-org-tree?Mathnum=' + r,
            method: 'GET',
            dataType: 'json',
            async: false,
            data: {selectable:true},
            success: function (json) {
                $('#edit_useunit_orgtree').treeview({
                    showTags: true,
                    data:json,
                    state: {
                    	 checked: true
                    },
                    //showCheckbox: true,
                    onNodeSelected: function (event, node) {
                    	//从展示框中移除
    	        	    $('#selected_edit_useunit').remove();
                        //选中
                    	addUseunitShow(node.id, node.text);
                    },
                    onNodeUnSelected: function (event, node) {
                        //取消选中
                    	$('#selected_edit_useunit').remove();
                    }
                });
                $("#win_selectUseunit").modal("toggle");
                loaded();
            },
            error: function () {
                loaded();
                alert('请求超时或系统出错');
            }
        });
	}
	
	//选择用户
	function fnSelectUser(type){//1:维护责任人;2:流程负责人
		curType = type;
		loading('正在加载数据,请稍候...');
		var sysuserId = $('#now_user_id').val();
	    var lesseeId = $('#now_user_lesseeId').val();
	    $("#win_selectUser").modal("toggle");
	  	//初始化组织结构树
	    var r = Math.random().toString().substring(5);
	    $.ajax({
	        url: CTX + 'organizationManage/query-user-sub-org-tree?Mathnum=' + r,
	        method: 'GET',
	        dataType: 'json',
	        async: false,
	        data: {sysuserId: sysuserId,isRoot: true},
	        success: function (json) {
	            $('#edit_sysuser_orgtree').treeview({
	                showTags: true,
	                data: json,
	                onNodeSelected: function (event, node) {
	                    $('#edit_sysuser_useunit').val(node.id);
	                    $("#edit_sysuser_orgusertable").bootstrapTable('refresh');
	                }
	            });
	        },
	        error: function () {
	            loaded();
	            alert('请求超时或系统出错');
	        }
	    });
	    
    	setTimeout(function(){
		    $('#edit_sysuser_orgtree').treeview('selectNode', [ 0, { silent: true } ]);
	    	var firstNode = $('#edit_sysuser_orgtree').treeview('getNode', 0);
	    	$('#edit_sysuser_useunit').val(firstNode.id);
    		//初始化用户表格
            var orgTableInit = new SysuserOrgTableInit();
            orgTableInit.Init();
    	},500);
	    
        loaded();
	}
	
	//初始化用户表
	var SysuserOrgTableInit = function () {
	    var oTableInit = new Object();
	  	//初始化Table
	    oTableInit.Init = function () {
	        $('#edit_sysuser_orgusertable').bootstrapTable({
	            url: CTX + 'organizationManage/query-sub-sysuser',         //请求后台的URL（*）
	            method: 'get',                      //请求方式（*）
	            // toolbar: '#toolbar',                //工具按钮用哪个容器
	            //toolbarAlign:'left',				//工具栏位置
	            striped: true,                      //是否显示行间隔色
	            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
	            pagination: true,                   //是否显示分页（*）
	            sortable: true,                     //是否启用排序
	            sortOrder: "asc",                   //排序方式
	            queryParams: oTableInit.queryParams,//传递参数（*）
	            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
	            pageNumber: 1,                       //初始化加载第一页，默认第一页
	            pageSize: 10,                       //每页的记录行数（*）
	            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
	            queryParamsType: "a",
	            search: true,                       //是否显示表格搜索
	            strictSearch: true,
	            showColumns: false,                  //是否显示所有的列
	            showRefresh: true,                  //是否显示刷新按钮
	            minimumCountColumns: 2,             //最少允许的列数
	            clickToSelect: true,                //是否启用点击选中行
	            singleSelect : true,
	            height: $(window).height()-350,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
	            uniqueId: "id",                     //每一行的唯一标识，一般为主键列
	            columns: [
	                 {
	                    field: 'name',
	                    title: '姓名',
	                    align : 'center',
	                    sortable: false
	                },
	                {
	                    checkbox: true
	                }
	            ],
	            onCheck:function(row){
	            	//从展示框中移除
	        	    $('#selected_edit_sysuser').remove();
	            	addSysuserShow(row.id, row.name);
	            },
	            onUncheck:function(row){
	            	//从展示框中移除
	        	    $('#selected_edit_sysuser').remove();
	            }
	        });
	        $('#edit_sysuser_orgusertable .search input').attr('placeholder', '姓名');
	    };
	    
	  	//得到查询的参数
	    oTableInit.queryParams = function (params) {
	        var data = JSON.stringify($('#sysuserOrgFormSearch').serializeJSON());
	        var temp = {   //这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
	            pageNum: params.pageNumber,//页码params.offset
	            size: params.pageSize,//页面大小params.limit
	            order: params.sortOrder,//排序 params.order
	            ordername: params.sortName,//排序字段 params.sort
	            from: data,
	            search: params.searchText
	        };
	        return temp;
	    };
	    return oTableInit;
	}
	
	//查询-刷新
	function queryInfo(pageNo){
		$('#step_table').bootstrapTable('refreshOptions',{pageNumber:1,pageSize:10});
	}
	
	//添加用户展示
	function addSysuserShow(id, name) {
	    var htmlStr = '';
	    htmlStr +=
	        '<div id="selected_edit_sysuser" class="allRoleSysuser" style="background-color:#3daae8;color:white;width:auto;hight:60px;float:left;margin:5px;">' +
	        '	<input type="hidden" name="sysuserid" class="sysuserid" value="' + id + '"/>' +
	        '   <spand style="padding-left: 5px;padding-right: 5px;">' + name + '</spand>' +
	        '   <input type="button" class="closeDiv" onclick="removeSysuser(\'' + id + '\', \'' + name + '\')" value="X" style="background:transparent;border:none;"/>' +
	        '</div>';
	    $("#sysuser_user_name").append(htmlStr);
	    
	    $('#temp_userId').val(id);
	    $('#temp_userName').val(name);
	}
	
	//移除用户
	function removeSysuser(id, name) {
	    //修改表格的复选框状态
	    var index = -1;
	    $('#edit_sysuser_orgusertable tr').each(function(){
	        if($(this).attr('data-uniqueid')==id){
	            index = $(this).attr('data-index');
	        }
	    });
	    if(index!=-1){
	        $('#edit_sysuser_orgusertable').bootstrapTable('uncheck',index);//根据下标index，修改选中状态
	    }else{
	        //从展示框中移除
	        $('#selected_edit_sysuser').remove();
	        
	        $('#temp_userId').val('');
		    $('#temp_userName').val('');
	    }
	}
	
	//添加部门展示
	function addUseunitShow(id, name) {
	    var htmlStr = '';
	    htmlStr +=
	        '<div id="selected_edit_useunit" class="allRoleSysuser" style="background-color:#3daae8;color:white;width:auto;hight:60px;float:left;margin:5px;">' +
	        '	<input type="hidden" name="sysuserid" class="sysuserid" value="' + id + '"/>' +
	        '   <spand style="padding-left: 5px;padding-right: 5px;">' + name + '</spand>' +
	        '   <input type="button" class="closeDiv" onclick="removeUseunit(\'' + id + '\', \'' + name + '\')" value="X" style="background:transparent;border:none;"/>' +
	        '</div>';
	    $("#useunit_name").append(htmlStr);
	    
	    $('#temp_useunitId').val(id);
	    $('#temp_useunitName').val(name);
	}
	
	//移除部门
	function removeUseunit(id, name) {
		$('#temp_useunitId').val('');
	    $('#temp_useunitName').val('');
	    
	    $('#edit_useunit_orgtree').treeview('unselectNode', [ id, { silent: true } ]);
	}
	
	//设置用户id
	function fnSetUserId(){
		var userId = $('#temp_userId').val();
		var userName =  $('#temp_userName').val();
		if(curType == 1){
	    	$('#flow_form').find("input[name='maintainer.id']").val(userId);
	    	$('#maintainerName').val(userName);
	    }else if(curType == 2){
	    	$('#flow_form').find("input[name='processLeader.id']").val(userId);
	    	$('#processLeaderName').val(userName);
	    }
		$("#win_selectUser").modal('hide');
	}
	
	//设置选中部门
	function fnSetUseunit(){
		var useunitId = $('#temp_useunitId').val();
		var useunitName =  $('#temp_useunitName').val();
	    $('#flow_form').find("input[name='responsibilityDept.id']").val(useunitId);
	    $('#responsibilityDeptName').val(useunitName);
		$("#win_selectUseunit").modal('hide');
	}
	
	//上传附件
	function fnUploadAnnex(folderId,folderName){
		//调用统一附件管理页面
		openUploadAnnexWin({
			folderId:folderId,
			folderName:folderName/* ,
			annexIds:annexIdStr */
		},function(data){
			//附件管理回调
			if(data.length>0){
				$.each(data,function(i,annex){
					$('#flow_form').find("input[name='chartId']").val(annex.id);
					fnAddChartShow(annex);
					fnSaveFlowChart();//保存流程图
				});
			}
			//单独保存附件字段
		});
	}
	
	//添加附件标签
	function fnAddChartShow(annex){
		$('#chart_img').remove();
		var htmlStr = '';
		if(annex.extendName.toLowerCase()=='jpg'||annex.extendName.toLowerCase()=='jpeg'||
				annex.extendName.toLowerCase()=='bmp'||annex.extendName.toLowerCase()=='gif'||
				annex.extendName.toLowerCase()=='png'){
			htmlStr += '<img id="chart_img" src="'+STATIC+annex.relativePath+'" alt="'+annex.name+'" onerror="this.src=\''+STATIC+'images/noPicture.jpg\';" style="margin:0 auto;max-width:100%;"/>';
		}else{
			POBrowser.openWindowModeless(CTX+'/view-file?annexId='+annex.id,'width=1240px;height=800px;');
		}
		$("#chart_content_div").append(htmlStr);
	}
	
	//保存流程图
	function fnSaveFlowChart(){
		var flowId = $('#flow_form').find("input[name='flowId']").val();
		if(flowId != null && flowId != ''){
			$.ajax({  
				url: CTX+'internal-control-flow/save-chart',
	            type: 'POST',  
	            data:$('#flow_form').serialize(),// 序列化表单值  
	            dataType: 'json',//服务端接收的数据类型
	            async: false,
	            success:function(json) {  
					if(json.success){

					}else{
						alert(json.msg);
					}
	            },  
	            error:function(json) {  
					loaded();
	            }  
	        });
		}
	}
	
	//新增流程步骤
	function fnAddFlowStep(){
		loading('正在跳转...');
		var flowId = $('#flowId').val();
		if(flowId == null || flowId == ''){
			alert("请先保存流程！");
			loaded();
			return;
		}else{
			loaded();
			flowId = $('#flowId').val(); 
			var r = Math.random().toString().substring(5);
			var url = CTX+'internal-flow-step/detail?opt=new&flowId='+flowId+'&Mathnum='+r;
			var name = "新增流程步骤";
			myShowModalDialogBR(url,name,window.screen.width,window.screen.height,function(v){
	 			if(v==1){
	 				queryInfo();
	 			}
	 		});
		}
	}
	
	//编辑流程步骤
	function fnEditFlowStep(){
		var seldatas = $('#step_table').bootstrapTable('getSelections');
		if(seldatas.length==0){
			alert('请选择流程步骤！');
			return;
		}
		if(seldatas.length>1){
			alert('只会编辑所选的第一项！');
		}
		var selData = seldatas[0];
		dId = selData.id;
		var flowId = $('#flowId').val();
		
		var r = Math.random().toString().substring(5);
		var url = CTX+'internal-flow-step/detail?opt=edit&flowId='+flowId+ '&id=' + dId +'&Mathnum='+r;
		var name = "流程步骤变更";
		myShowModalDialogBR(url,name,window.screen.width,window.screen.height,function(v){
 			if(v==1){
 				queryInfo();
 			}
 		});
	}
	
	//批量删除流程步骤
	function fnDeleteFlowStep(){
		var seldatas = $('#step_table').bootstrapTable('getSelections');
		if(seldatas.length==0){
			return;
		}
		loading('正在删除,请稍候...');
		var ids = "";
		for(var i = 0; i < seldatas.length ; i++){
			ids += "," + seldatas[i].id;
		}
		ids = ids.substring(1);
		$.ajax({
            url: CTX + 'internal-flow-step/delete',
            method: 'post',
            dataType: 'json',
            data: {ids:ids},
            success: function (json) {
                alert(json.msg);
                queryInfo();
                loaded();
            },
            error: function () {
                alert('请求超时或系统出错!');
            }
        });
		
	}
	
	//查看工作用表
	function fnViewWorkTable(dId){
		var r = Math.random().toString().substring(5);
		var url = CTX+'work-table-info/view?id='+dId+'&Mathnum='+r;
		var name = "工作用表详情";
		window.open(url,'_blank','width='+window.screen.width+',height='+window.screen.height);
	}
	
	//格式化附件显示
	function fnFormatAnnexShow(annexIds,annexNames){
		var idArr = annexIds.split(',');
		var nameArr = annexNames.split(',');
		var resultStr = "";
		for(var i = 0; i < idArr.length; i++){
			var aStr = '<a class="a_tableName" title="点击下载" href="javascript:openCommonViewImgWin(\'' + idArr[i] + '\')">'+ nameArr[i] +'</a>';
			if(i==0){
				resultStr = aStr;
			}else{
				resultStr += "<br>" + aStr;
			}
		}
		return resultStr;
	}
	
	//初始化按钮
	var ButtonInit = function () {
	    var oInit = new Object();
	    var postdata = {};

	    oInit.Init = function () {
	        //初始化页面上面的按钮事件
	    };

	    return oInit;
	};
		
	/*]]>*/
</script>
<script type="text/javascript" th:src="@{/static/modules/internal/internal-file-upload.js}"></script>	
</html>
