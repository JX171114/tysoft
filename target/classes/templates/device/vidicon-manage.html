<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta http-equiv="pragma" content="no-cache" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="Cache-Control" content="no-store" />
	<meta http-equiv="Expires" content="0" />
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
	<title>监控设备管理</title>
	<!-- Bootstrap 3.3.7 -->
	<link rel="stylesheet" th:href="@{/static/bootstrap/css/bootstrap.min.css}" />
	<link rel="stylesheet" th:href="@{/static/dist/css/font-awesome.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/dist/css/ionicons.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/dist/css/AdminLTE.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.css}" />
	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/bootstrap-validator/css/bootstrapValidator.min.css}"/>
	<link rel="stylesheet" th:href="@{/static/plugins/iCheck/all.css}"/>
</head>
<body class="container-fluid">
	<div class="row">
		<div class="col-md-3">
			<div id="menuTree" data-toggle="context" data-target="#context-menu" style="margin-top:10px;"></div>
			<div id="context-menu">
			    <ul class="dropdown-menu" role="menu">
			      <li><a tabindex="-1" id="addMenu"><em id="addMenu" class="glyphicon glyphicon-plus"></em>增加分组</a></li>
			      <li><a tabindex="-1" id="editMenu"><em id="editMenu" class="glyphicon glyphicon-pencil"></em>修改分组</a></li>
			      <li><a tabindex="-1" id="removeMenu"><em id="removeMenu" class="glyphicon glyphicon-remove"></em>删除</a></li>
		    	</ul>
		  	</div>
		</div>
		<div class="col-md-9"  style="border-left:1px solid #ccc;">
			<div id="toolbar" class="btn-group">
				<button id="btn_add" type="button"
					class="btn btn-primary">
					<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
				</button>
				<button id="btn_edit" type="button"
					class="btn btn-warning">
					<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
				</button>
				<button id="btn_delete" type="button"
					class="btn btn-danger">
					<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
				</button>
			</div>
			<table id="dataList"></table>
		</div>
	</div>
	
	<!-- 编辑分组窗体 -->
	<div class="modal fade" id="vidiconGroup_editModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h4 class="modal-title">新增分组</h4>
				</div>
				<div class="modal-body">
					<form id="vidiconGroupForm" role="form" class="form-horizontal">
						<input type="hidden" name="id" />
						<input type="hidden" name="projectInfo.id" th:value="${projectInfo.id}"/>
						<div class="form-group">
							<label class="col-sm-3 control-label">分组名称：</label>
							<div class="col-sm-9">
							  <input type="text" class="form-control" name="groupName"/>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					 <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button> 
					 <button type="button" class="btn btn-primary" onclick="submitVidiconGroupForm(this)">保存</button>
				</div>
			</div>
		</div>
	</div>
	
	<div class="modal fade" id="vidicon_editModal" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" aria-hidden="true">
		<div class="modal-dialog" style="width:900px;">
			<div class="modal-content">
				<div class="modal-header">
				 	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h4 class="modal-title">新增设备</h4>
				</div>
				<div class="modal-body" style="overflow: hidden; padding: 10px;">
					<form class="form-horizontal" id="vidicon_form">
	            		<input type="hidden" name="id" value=""/>
	            		<input type="hidden" id="projectInfoId" name="projectInfo.id" th:value="${projectInfo.id}"/>
	            		<div class="row">
	            			<div class="col-md-6">
	            				<div class="form-group">
				                  <label class="col-sm-3 control-label">设备名称</label>
				                  <div class="col-sm-9">
				                  	<input type="text" class="form-control" name="name" placeholder="输入设备名称"/>
				                  </div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">设备IP地址</label>
				                  <div class="col-sm-9">
				                  	<input type="text" class="form-control" name="ipAddr" placeholder="输入设备IP地址"/>
				                  </div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">所属分组</label>
				                  <div class="col-sm-9">
				                  	<select class="form-control" name="vidiconGroup.id">
				                  		<option value="">请选中分组</option>
				                  	</select>
				                  </div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">平台地址(内)</label>
				                  <div class="col-sm-9">
				                  	<input type="text" class="form-control" name="serverInIp" placeholder="输入平台内网地址"/>
				                  </div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">平台地址(外)</label>
				                  <div class="col-sm-9">
				                  	<input type="text" class="form-control" name="serverOutIp" placeholder="输入平台外网地址"/>
				                  </div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">平台用户名</label>
				                  <div class="col-sm-9">
				                  	<input type="text" class="form-control" name="userName" placeholder="输入平台登录用户名"/>
				                  </div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">是否云台</label>
				                  <div class="col-sm-9" style="padding-top:8px;">
				                  	<label style="float: left;">
				                  		<input type="radio" class="minimal" name="isCloud" value="true"/>&nbsp;是
				                  	</label>
				                  	<label style="float: left;margin-left:10px;">
				                  		<input type="radio" class="minimal" name="isCloud" value="false" checked="checked"/>&nbsp;否
				                  	</label>
				                  </div>
				                </div>
	            			</div>
	            			<div class="col-md-6">
	            				<div class="form-group">
				                  <label class="col-sm-3 control-label">设备类型</label>
				                  <div class="col-sm-9">
				                  	<select class="form-control" name="vidiconType">
				                  		<option value="1">枪机</option>
				                  		<option value="2">球机</option>
				                  	</select>
				                  </div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">设备编号</label>
				                  <div class="col-sm-9">
				                  	<input type="text" class="form-control" name="vidiconId" placeholder="输入设备编号"/>
				                  </div>
				                </div>
				                <div class="form-group">
				                  	<label class="col-sm-3 control-label">地理位置:</label>
				                  	<div class="col-sm-9">
				                  		<div class="input-group">
							                <input type="text" class="form-control" name="lngLat"/>
							                <div class="input-group-btn">
							                	<button type="button" class="btn btn-primary" onclick="fnChooseLnglat()">选点</button>
							                </div>
						              	</div>
				                  	</div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">平台端口(内)</label>
				                  <div class="col-sm-9">
				                  	<input type="number" class="form-control" name="serverInPort" placeholder="输入平台内网端口"/>
				                  </div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">平台端口(外)</label>
				                  <div class="col-sm-9">
				                  	<input type="number" class="form-control" name="serverOutPort" placeholder="输入平台外网端口"/>
				                  </div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">平台密码</label>
				                  <div class="col-sm-9">
				                  	<input type="password" class="form-control" name="userPwd" placeholder="输入平台登录密码"/>
				                  </div>
				                </div>
				                <div class="form-group">
				                  <label class="col-sm-3 control-label">主要监控点</label>
				                  <div class="col-sm-9" style="padding-top:8px;">
				                  	<label style="float: left;">
				                  		<input type="radio" class="minimal" name="isPrimary" value="true"/>&nbsp;是
				                  	</label>
				                  	<label style="float: left;margin-left:10px;">
				                  		<input type="radio" class="minimal" name="isPrimary" value="false" checked="checked"/>&nbsp;否
				                  	</label>
				                  </div>
				                </div>
	            			</div>
	            		</div>
	            	</form>
				</div>
				<div class="modal-footer">
					 <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button> 
					 <button id="btnSubmit" type="button" onclick="submitVidiconForm(this)" class="btn btn-primary">保存</button>
				</div>
			</div>
		</div>
	</div>
</body>
<!-- jQuery 2.2.3 -->
<script th:src="@{/static/plugins/jQuery/jquery-2.2.3.min.js}"></script>
<!-- Bootstrap 3.3.7 -->
<script th:src="@{/static/bootstrap/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/common.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-toggle/bootstrap-toggle.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-validator/js/bootstrapValidator.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-table/dist/bootstrap-table.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-treeview/bootstrap-treeview.min.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/bootstrap-contextmenu/bootstrap-contextmenu.js}"></script>
<!-- icheck -->
<script type="text/javascript" th:src="@{/static/plugins/iCheck/icheck.min.js}"></script>
<script type="text/javascript" th:inline="javascript">
/*<![CDATA[*/
	var CTX = [[@{/}]];
	var STATIC = [[@{/static/}]];
	
	$(function(){
		$('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({
	      	checkboxClass: 'icheckbox_minimal-blue',
	      	radioClass: 'iradio_minimal-blue'
	    });
		//1.初始化分组
		initMenuTree();
		//2.初始化Table
	    var oTable = new TableInit();
	    oTable.Init();
	  	//3.初始化Button的点击事件
	    $('#toolbar button').on('click',function(){
			//新增
			if($(this).attr('id')=='btn_add'){
				$('#vidicon_editModal').find('.modal-title').html('新增设备');
				$('#vidicon_editModal').modal('toggle');
				if(currentGroupId!=null){
					$("#vidicon_form select[name='vidiconGroup.id']").val(currentGroupId);
				}
			}
			 //编辑
			if($(this).attr('id')=='btn_edit'){
				doEdit();
			}
			//删除
			if($(this).attr('id')=='btn_delete'){
				var seldatas = $('#dataList').bootstrapTable('getSelections');
				if(seldatas.length<=0){
					alert('没有选中项');
					return;
				}
				var delIds = '';
				$.each(seldatas,function(i,data){
					delIds += ','+data.id;
				});
				doDel(delIds.substring(1));
			}
		});
	  	
	  	$('#vidicon_editModal').on('hidden.bs.modal',function(){
	  		fnResetVidiconForm();
	  	});
	  	$('#vidiconGroup_editModal').on('hidden.bs.modal',function(){
	  		$("#vidiconGroupForm input[name='id']").val('');
	  		$('#vidiconGroupForm').bootstrapValidator('resetForm', true);
	  	});
	  	
	  	$('#vidiconGroupForm').bootstrapValidator({
			message: '此处输入有误',
	        excluded: [':disabled'],
	        feedbackIcons: {
	            valid: 'glyphicon glyphicon-ok',
	            invalid: 'glyphicon glyphicon-remove',
	            validating: 'glyphicon glyphicon-refresh'
	        },
	        fields:{
	        	'groupName':{
	        		message: '分组名称输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '分组名称不可为空'
	                    },
	                    stringLength: {
	                        max: 10,
	                        message: '长度必须在20个字内'
	                    }
	                }
	        	}
	        }
		});
	  	$('#vidicon_form').bootstrapValidator({
			message: '此处输入有误',
	        excluded: [':disabled'],
	        feedbackIcons: {
	            valid: 'glyphicon glyphicon-ok',
	            invalid: 'glyphicon glyphicon-remove',
	            validating: 'glyphicon glyphicon-refresh'
	        },
	        fields:{
	        	'name':{
	        		message: '设备名称输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '设备名称不可为空'
	                    },
	                    stringLength: {
	                        max: 50,
	                        message: '名称长度必须在50个字内'
	                    }
	                }
	        	},
	        	'vidiconId':{
	        		message: '设备编号输入不合法',
	                validators: {
	                    notEmpty: {
	                        message: '设备编号不可为空'
	                    },
	                    stringLength: {
	                        max: 50,
	                        message: '编号长度必须在50个字内'
	                    }
	                }
	        	}
	        }
		});
	});
	
	function doEdit(id){
		fnResetVidiconForm();
		var editId = null;
		if(id){
			editId = id;
		}else{
			var seldatas = $('#dataList').bootstrapTable('getSelections');
			if(seldatas.length<=0){
				alert('请选择一项来编辑');
				return;
			}
			if(seldatas.length>1){
				alert('只会编辑所选的第一项');
			}
			var selData = seldatas[0];
			editId = selData.id;
		}
		$('#vidicon_editModal').find('.modal-title').html('编辑设备');
		$('#vidicon_editModal').modal('toggle');
		$.ajax({
			url:CTX+'vidicon/find-vidicon',
			method:'GET',
			dataType:'json',
			data:{id:editId},
			success:function(json){
				if(json){
					$("#vidicon_form input[name='id']").val(json.id);
					$("#vidicon_form input[name='name']").val(json.name);
					$("#vidicon_form select[name='vidiconType']").val(json.vidiconType);
					$("#vidicon_form input[name='vidiconId']").val(json.vidiconId);
					$("#vidicon_form select[name='vidiconGroup.id']").val(json.vidiconGroup.id);
					$("#vidicon_form input[name='lngLat']").val(json.lngLat);
					$("#vidicon_form input[name='ipAddr']").val(json.ipAddr);
					$("#vidicon_form input[name='serverInIp']").val(json.serverInIp);
					$("#vidicon_form input[name='serverInPort']").val(json.serverInPort);
					$("#vidicon_form input[name='serverOutIp']").val(json.serverOutIp);
					$("#vidicon_form input[name='serverOutPort']").val(json.serverOutPort);
					$("#vidicon_form input[name='userName']").val(json.userName);
					$("#vidicon_form input[name='userPwd']").val(json.userPwd);
					$("#vidicon_form input[name='isCloud'][value="+json.isCloud+"]").iCheck('check');
					$("#vidicon_form input[name='isPrimary'][value="+json.isPrimary+"]").iCheck('check');
				}
			},
			error:function(){
				alert('请求超时或系统出错');
			}
		});
	}
	
	function fnResetVidiconForm(){
		$('#vidicon_form').bootstrapValidator('resetForm', true);
		$("#vidicon_form input[name='id']").val('');
		$("#vidicon_form select[name='vidiconGroup.id']").val('');
		$("#vidicon_form input[name='lngLat']").val('');
		$("#vidicon_form input[name='ipAddr']").val('');
		$("#vidicon_form input[name='serverInIp']").val('');
		$("#vidicon_form input[name='serverInPort']").val('');
		$("#vidicon_form input[name='serverOutIp']").val('');
		$("#vidicon_form input[name='serverOutPort']").val('');
		$("#vidicon_form input[name='userName']").val('');
		$("#vidicon_form input[name='userPwd']").val('');
	}
	var currentNode = null;
	var currentGroupId = null;
	function initMenuTree(){
		$.ajax({
			url:CTX+'vidicon/query-vidicon-group',
			method:'GET',
			dataType:'json',
			data: {projectInfoId: $('#projectInfoId').val()},
			success:function(json){
				var treedata = [{
					id:0,
			    	text: "右键添加分组",
			    	treeCode:'0',
			    	color:'#ccc',
			    	selectable:false,
			    	nodes:json
			  	}];
				$('#menuTree').treeview({
					showTags: true,
					data: treedata
				}).on('nodeSelected',function(event, data){
					currentGroupId = data.id;
					queryInfo();
				}).on('nodeUnselected',function(event, data){
					currentGroupId = null;
					queryInfo();
				});
				$('#menuTree').treeview('expandAll');
				initTreeContextmenu();
				//初始化分组下拉框
				if(json.length>0){
					var htmlStr = '<option value="">选中分组</option>';
					$.each(json,function(i,group){
						htmlStr += '<option value="'+group.id+'">'+group.text+'</option>';
					});
					$("#vidicon_form select[name='vidiconGroup.id']").html(htmlStr);
				}
			},
			error:function(){
				alert('请求超时或系统出错');
			}
		});
	}
	function initTreeContextmenu(){
		$('#menuTree').contextmenu({
			target:'#context-menu',
			before: function(e, context) {
				var nodeId = e.target.getAttribute("data-nodeid");
				var node = $('#menuTree').treeview('getNode', nodeId);
				currentNode = node;
				$('#addMenu,#removeMenu,#editMenu').show();
				if(currentNode.treeCode=='0'){
					$('#removeMenu,#editMenu').hide();
					$('#addMenu').show();
				}else{
					$('#addMenu').hide();
				}
			},
			onItem: function(context, e) {
				var operId = e.target.getAttribute('id');
				if(operId=='addMenu'){
					goAddVidiconGroup();
				}
				if(operId == 'editMenu'){
					goEditVidiconGroup();
				}
				if(operId == 'removeMenu'){
					goDelVidiconGroup();
				}
			}
		});
	}
	
	function goAddVidiconGroup(){
		$('#vidiconGroup_editModal').modal('toggle');
		$('#vidiconGroup_editModal .modal-title').html('新增分组');
	}
	
	function goEditVidiconGroup(){
		$('#vidiconGroup_editModal').modal('toggle');
		$('#vidiconGroup_editModal .modal-title').html('编辑分组');
		var groupId = currentNode.id;
		$.ajax({
			url:CTX+'vidicon/find-vidicon-group',
			data:{groupId:groupId},
			method:'GET',
			dataType:'json',
			success:function(json){
				if(json){
					$("#vidiconGroupForm input[name='id']").val(json.id);
					$("#vidiconGroupForm input[name='groupName']").val(json.groupName);
				}
			},
			error: function(){
				alert('系统错误或请求超时');
				$('#vidiconGroup_editModal').modal('toggle');
			}
		});
	}
	
	function goDelVidiconGroup(){
		if(window.confirm('确定要删除改分组吗?')){
			var groupId = currentNode.id;
			$.ajax({
				url:CTX+'vidicon/del-vidicon-group',
				data:{groupIds:groupId},
				method:'POST',
				dataType:'json',
				success:function(json){
					if(json.success){
						initMenuTree();
					}
				},
				error: function(){
					alert('系统错误或请求超时');
				}
			});		
		}
	}
	
	function submitVidiconGroupForm(_this){
		var result = $('#vidiconGroupForm').data('bootstrapValidator');
		result.validate();
		if(result.isValid()){
			var oldTxt = $(_this).text();
			$(_this).attr('disabled','disabled');
			$(_this).html('保存中...');
			$.ajax({
				url: CTX+'vidicon/save-vidicon-group',
				type: 'POST',  
	            data:$('#vidiconGroupForm').serialize(),// 序列化表单值  
	            dataType: 'json',
	            success:function(json) {
					$(_this).removeAttr('disabled');
					$(_this).html(oldTxt);
					if(json.success){
						$('#vidiconGroup_editModal').modal('toggle');
						initMenuTree();
					}
	            },
	            error:function(json) {  
	            	alert('请求超时或系统出错!');
	            	$(_this).removeAttr('disabled');
					$(_this).html(oldTxt);
	            }
			});
		}
	}
	
	function submitVidiconForm(_this){
		var result = $('#vidicon_form').data('bootstrapValidator');
		result.validate();
		if(result.isValid()){
			var oldTxt = $(_this).text();
			$(_this).attr('disabled','disabled');
			$(_this).html('保存中...');
			$.ajax({
				url: CTX+'vidicon/save-vidicon',
				type: 'POST',  
	            data:$('#vidicon_form').serialize(),// 序列化表单值  
	            dataType: 'json',
	            success:function(json) {
					$(_this).removeAttr('disabled');
					$(_this).html(oldTxt);
					if(json.success){
						queryInfo();
						initMenuTree();
						$('#vidicon_editModal').modal('toggle');
					}
	            },
	            error:function(json) {  
	            	alert('请求超时或系统出错!');
	            	$(_this).removeAttr('disabled');
					$(_this).html(oldTxt);
	            }
			});
		}
	}
	
	function doDel(id){
		if(window.confirm('确定要删除所选设备吗?')){
			$.ajax({
				url:CTX+'vidicon/del-vidicon',
				data:{vidiconIds:id},
				method:'POST',
				dataType:'json',
				success:function(json){
					if(json.success){
						queryInfo();
						initMenuTree();
					}
				},
				error: function(){
					alert('系统错误或请求超时');
				}
			});		
		}
	}
	
	
	//初始化列表
	var TableInit = function () {
	    var oTableInit = new Object();
	    //初始化Table
	    oTableInit.Init = function () {
	        $('#dataList').bootstrapTable({
	        	url: CTX + 'vidicon/query-vidicon-page',         //请求后台的URL（*）
	            method: 'get',                      //请求方式（*）
	            toolbar: '#toolbar',                //工具按钮用哪个容器
	            striped: false,                      //是否显示行间隔色
	            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
	            pagination: true,                   //是否显示分页（*）
	            sortable: false,                     //是否启用排序
	            sortOrder: "asc",                   //排序方式
	            queryParams: oTableInit.queryParams,//传递参数（*）
	            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
	            pageNumber:1,                       //初始化加载第一页，默认第一页
	            pageSize: 10,                       //每页的记录行数（*）
	            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
	            queryParamsType: "a",
	            search: true,                       //是否显示表格搜索
	            strictSearch: true,
	            showColumns: true,                  //是否显示所有的列
	            showRefresh: true,                  //是否显示刷新按钮
	            minimumCountColumns: 2,             //最少允许的列数
	            clickToSelect: true,                //是否启用点击选中行
	            height: $(window).height(),         //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
	            uniqueId: "id",                     //每一行的唯一标识，一般为主键列
	            showToggle:true,                    //是否显示详细视图和列表视图的切换按钮
	            cardView: false,                    //是否显示详细视图
	            detailView: false,                  //是否显示父子表
	            showExport: false,                     //是否显示导出
	            exportDataType: "basic",              //basic', 'all', 'selected'.
	            exportTypes:[ 'excel','doc', 'xml','csv','json'],  //导出文件类型
	            exportOptions:{  
	                ignoreColumn: [0],  //忽略某一列的索引 ,如 [0,1]
	                fileName: '监控设备表导出',  //文件名称设置  
	                worksheetName: '信息',  //表格工作区名称  
	                tableName: '监控设备表导出文件'
	            },
	            columns: [
				{
	            	checkbox:true
		        },{
				    field: 'name',
				    title:'摄像机名称',
				    sortable:true,
				    align : 'center',
				},{
				    field: 'vidiconType',
				    title:'摄像机类型',
				    sortable:true,
				    align : 'center',
				    formatter : function(v) {
				    	if(v==1){
				    		return '枪机';
				    	}
				    	if(v==2){
				    		return '球机';
				    	}
					}
				},{
				    field: 'vidiconId',
				    title:'摄像机编号',
				    sortable:true,
				    align : 'center',
				},{
				    field: 'isOnline',
				    title:'是否在线',
				    align : 'center',
				    formatter : function(v) {
				    	return v==true?'是':'否';
					}
				},{
				    field: 'isCloud',
				    title:'是否云台',
				    align : 'center',
				    formatter : function(v) {
				    	return v==true?'是':'否';
					}
				},{
				    field: 'vidiconGroup',
				    title:'设备分组',
				    align : 'center',
				    formatter: function (val) {
                       	return val.groupName;
                    }
				},{
					field : 'operate',
					title : '操作',
					align : 'center',
					valign : 'middle',
					clickToSelect : false,
                    formatter: function (value, row, index) {
                    	var operateHtml = '<button type="button" onclick="doEdit(\''+row.id+'\')" style=" background: none; border:none;"><i class="glyphicon glyphicon-edit icon-edit" style="color:green;"></i>&nbsp;</button> &nbsp;';
                    	operateHtml += '<button type="button" onclick="doDel(\''+row.id+'\')" style=" background: none; border:none;"><i class="glyphicon glyphicon-remove icon-remove" style="color:red;"></i>&nbsp;</button>';
                        return operateHtml;
                    }
				}, ]
	        });
	        $('.search input').attr('placeholder','设备名称');
	    };

	    //得到查询的参数
	    oTableInit.queryParams = function (params) {
	        var temp = {   //这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
	        	projectInfoId: $("#projectInfoId").val(),
	        	vidiconGroupId: currentGroupId,
	    		pageNo: params.pageNumber,//页码params.offset
                pageSize: params.pageSize,//页面大小params.limit
                order: params.sortOrder,//排序 params.order
                ordername: params.sortName,//排序字段 params.sort
	            search:params.searchText
	        };
	        return temp;
	    };
	    return oTableInit;
	};
	
	//查询-刷新
	var queryInfo = function(){
		$('#dataList').bootstrapTable('refresh',{pageNumber:1,pageSize:10});
	}
	
	
	function fnChooseLnglat(){
		var lngLat = $("#vidicon_form input[name='lngLat']").val();
		var width = $(window.parent).width()*3/4;//定义长度
		var height = $(window.parent).height()-50;
		var url = CTX+"main/select-lnglat?lngLat="+lngLat;
		top.openCommonFrameWin(url,width,height,function(returnData){
			$("#vidicon_form input[name='lngLat']").val(returnData);
		});
		/* top.returnData = null;
		var title;
		var url = CTX+"main/select-lnglat?lngLat="+lngLat;
		var dlg = top.Dialog ? new top.Dialog() : new Dialog();//定义Dialog对象
		dlg.Model = true;
		dlg.Drag = false;
		dlg.Width = $(window.parent).width()*3/4;//定义长度
		dlg.Height =$(window.parent).height()-50;	
		dlg.URL = url;
		dlg.Title = "请在地图上标注位置";
		dlg.CancelEvent = function() {
			if (top.returnData) {	
				$("#vidicon_form input[name='lngLat']").val(top.returnData);
			}
			dlg.close();
		}
		dlg.show(); */
	}
/*]]>*/	
</script>
</html>